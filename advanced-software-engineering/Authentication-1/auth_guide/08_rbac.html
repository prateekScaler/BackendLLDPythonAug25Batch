<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RBAC - Role-Based Access Control</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Fira+Code:wght@400;500&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <style>
        .rbac-diagram {
            background: linear-gradient(135deg, #e7f5ff 0%, #d0ebff 100%);
            border: 2px solid #74c0fc;
            border-radius: 16px;
            padding: 2rem;
            margin: 1.5rem 0;
            text-align: center;
        }
        .rbac-flow {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 1rem;
            flex-wrap: wrap;
            margin: 1.5rem 0;
        }
        .rbac-box {
            background: white;
            border: 2px solid var(--border-color);
            border-radius: 12px;
            padding: 1rem 1.5rem;
            min-width: 120px;
            text-align: center;
        }
        .rbac-box.user { border-color: #339af0; background: #e7f5ff; }
        .rbac-box.role { border-color: #51cf66; background: #d3f9d8; }
        .rbac-box.permission { border-color: #ff6b6b; background: #ffe3e3; }
        .rbac-box-icon { font-size: 2rem; margin-bottom: 0.5rem; }
        .rbac-box-label { font-weight: 600; font-size: 0.9rem; }
        .rbac-arrow { font-size: 1.5rem; color: var(--text-muted); }
        .model-card {
            background: var(--bg-primary);
            border-radius: 12px;
            padding: 1.5rem;
            margin: 1rem 0;
            border: 2px solid var(--border-color);
        }
        .model-card h4 {
            color: var(--accent-color);
            margin-bottom: 0.5rem;
        }
        .hierarchy-visual {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 1.5rem;
            margin: 1rem 0;
            font-family: 'Fira Code', monospace;
            font-size: 0.85rem;
            overflow-x: auto;
        }
        .permission-badge {
            display: inline-block;
            background: #e9ecef;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-family: 'Fira Code', monospace;
            font-size: 0.8rem;
            margin: 0.25rem;
        }
        .permission-badge.granted { background: #d3f9d8; color: #2f9e44; }
        .permission-badge.denied { background: #ffe3e3; color: #e03131; }
        .real-world-example {
            background: linear-gradient(135deg, #fff9db 0%, #ffec99 100%);
            border: 2px solid #fab005;
            border-radius: 12px;
            padding: 1.5rem;
            margin: 1.5rem 0;
        }
        .real-world-example h4 {
            color: #e67700;
            margin-bottom: 1rem;
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="navbar-content">
            <a href="index.html" class="navbar-brand">ğŸ” Auth Guide</a>
            <div class="navbar-nav">
                <a href="index.html" class="nav-btn">Home</a>
                <a href="07_cheatsheet.html" class="nav-btn">Cheat Sheet</a>
            </div>
        </div>
    </nav>

    <div class="container">
        <header class="page-header">
            <div class="page-icon">ğŸ‘¥</div>
            <h1>Role-Based Access Control (RBAC)</h1>
            <p class="subtitle">Managing permissions at scale</p>
        </header>

        <div class="section">
            <h2>What is RBAC?</h2>
            <p>Instead of assigning permissions directly to users, RBAC assigns permissions to <strong>roles</strong>, and users are assigned to roles. This makes permission management scalable and auditable.</p>

            <div class="rbac-diagram">
                <h3 style="margin-bottom: 1rem;">The RBAC Model</h3>
                <div class="rbac-flow">
                    <div class="rbac-box user">
                        <div class="rbac-box-icon">ğŸ‘¤</div>
                        <div class="rbac-box-label">Users</div>
                    </div>
                    <div class="rbac-arrow">â†’</div>
                    <div class="rbac-box role">
                        <div class="rbac-box-icon">ğŸ­</div>
                        <div class="rbac-box-label">Roles</div>
                    </div>
                    <div class="rbac-arrow">â†’</div>
                    <div class="rbac-box permission">
                        <div class="rbac-box-icon">ğŸ”‘</div>
                        <div class="rbac-box-label">Permissions</div>
                    </div>
                </div>
                <p style="margin-top: 1rem; color: var(--text-muted);">Users get permissions indirectly through their roles</p>
            </div>
        </div>

        <div class="section">
            <h2>The ELI5 Version: Company Analogy</h2>

            <div class="info-box">
                <p><strong>Think of a company with job titles:</strong></p>
                <ul>
                    <li><strong>CEO</strong> can do everything</li>
                    <li><strong>Manager</strong> can approve leave, view team data</li>
                    <li><strong>Employee</strong> can only view their own data</li>
                </ul>
                <p style="margin-top: 1rem;">When Alice joins as a Manager, we don't set 50 individual permissions - we just assign the "Manager" role and she instantly gets all Manager permissions!</p>
            </div>

            <div class="comparison-grid">
                <div class="comparison-item bad">
                    <h4>âŒ Without RBAC</h4>
                    <p>Assign permissions to each user individually</p>
                    <pre><code class="language-text">User1 â†’ Permission A, B, C
User2 â†’ Permission A, B, C
User3 â†’ Permission A, B, C
... (nightmare at scale!)</code></pre>
                </div>
                <div class="comparison-item good">
                    <h4>âœ… With RBAC</h4>
                    <p>Assign users to roles</p>
                    <pre><code class="language-text">Role "Editor" â†’ Permission A, B, C
User1 â†’ Role "Editor"
User2 â†’ Role "Editor"
User3 â†’ Role "Editor"</code></pre>
                </div>
            </div>
        </div>

        <div class="section">
            <h2>RBAC Core Components</h2>

            <div class="card-grid">
                <div class="card" style="cursor: default;">
                    <div class="card-icon">ğŸ‘¤</div>
                    <h3>Users</h3>
                    <p>Individuals who need system access</p>
                </div>
                <div class="card" style="cursor: default;">
                    <div class="card-icon">ğŸ­</div>
                    <h3>Roles</h3>
                    <p>Named collections of permissions (Admin, Editor, Viewer)</p>
                </div>
                <div class="card" style="cursor: default;">
                    <div class="card-icon">ğŸ”‘</div>
                    <h3>Permissions</h3>
                    <p>Specific actions (read:posts, delete:users)</p>
                </div>
            </div>

            <div class="diagram">
<pre>
RBAC MAPPING EXAMPLE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

USERS              ROLES              PERMISSIONS
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Alice  â”‚â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚  Admin  â”‚â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ users:create     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”Œâ”€â”€â–ºâ”‚ users:read       â”‚
                       â”‚          â”‚   â”‚ users:delete     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚          â”‚   â”‚ posts:create     â”‚
â”‚   Bob   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚   â”‚ posts:delete     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚  Editor â”‚â”€â”€â”€â”€â”˜
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚ Charlie â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚  Viewer â”‚â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ posts:read       â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</pre>
            </div>
        </div>

        <div class="section">
            <h2>Role Hierarchy</h2>
            <p>Roles can inherit permissions from other roles, creating a hierarchy:</p>

            <div class="hierarchy-visual">
<pre>
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  Super Admin  â”‚  â† Has ALL permissions
                    â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚ inherits
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚     Admin     â”‚  â† Has admin + inherited
                    â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚             â”‚             â”‚
       â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
       â”‚   Editor    â”‚ â”‚Moderatorâ”‚ â”‚  Analyst   â”‚
       â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
              â”‚             â”‚             â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
                     â”‚    Viewer   â”‚  â† Base role (read-only)
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</pre>
            </div>

            <div class="success-box">
                <strong>Key Insight:</strong> A Super Admin automatically gets all permissions from Admin, Editor, Moderator, Analyst, and Viewer through inheritance!
            </div>
        </div>

        <div class="section">
            <h2>RBAC vs Other Models</h2>

            <div class="table-container">
                <table>
                    <tr>
                        <th>Model</th>
                        <th>Based On</th>
                        <th>Best For</th>
                        <th>Example</th>
                    </tr>
                    <tr>
                        <td><strong>DAC</strong><br>(Discretionary)</td>
                        <td>Owner's choice</td>
                        <td>Small systems</td>
                        <td>Unix file permissions</td>
                    </tr>
                    <tr>
                        <td><strong>MAC</strong><br>(Mandatory)</td>
                        <td>Security labels</td>
                        <td>Military/Government</td>
                        <td>Top Secret clearance</td>
                    </tr>
                    <tr>
                        <td><strong>RBAC</strong><br>(Role-Based)</td>
                        <td>User's role</td>
                        <td>Enterprises</td>
                        <td>Admin/Editor/Viewer</td>
                    </tr>
                    <tr>
                        <td><strong>ABAC</strong><br>(Attribute-Based)</td>
                        <td>Multiple attributes</td>
                        <td>Complex policies</td>
                        <td>Role + Time + Location</td>
                    </tr>
                </table>
            </div>

            <div class="model-card">
                <h4>ABAC Example: More Fine-Grained Control</h4>
                <pre><code class="language-text">IF role = "Manager"
   AND time = "9am-5pm"
   AND location = "Office"
   AND department = "Finance"
THEN allow access to financial reports</code></pre>
                <p style="margin-top: 0.5rem; color: var(--text-muted);">ABAC considers multiple attributes, not just role</p>
            </div>
        </div>

        <div class="section">
            <h2>Real-World Examples</h2>

            <div class="real-world-example">
                <h4>GitHub Repository Roles</h4>
                <table style="width: 100%; background: white; border-radius: 8px;">
                    <tr>
                        <th>Role</th>
                        <th>Permissions</th>
                    </tr>
                    <tr>
                        <td><strong>Read</strong></td>
                        <td>Clone, pull, view issues</td>
                    </tr>
                    <tr>
                        <td><strong>Triage</strong></td>
                        <td>+ Manage issues and PRs</td>
                    </tr>
                    <tr>
                        <td><strong>Write</strong></td>
                        <td>+ Push to branches</td>
                    </tr>
                    <tr>
                        <td><strong>Maintain</strong></td>
                        <td>+ Manage settings</td>
                    </tr>
                    <tr>
                        <td><strong>Admin</strong></td>
                        <td>+ Full access (dangerous actions)</td>
                    </tr>
                </table>
            </div>

            <div class="real-world-example">
                <h4>AWS IAM Policy</h4>
                <pre><code class="language-python"># AWS IAM Policy (JSON)
{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Effect": "Allow",
            "Action": [
                "s3:GetObject",
                "s3:PutObject"
            ],
            "Resource": "arn:aws:s3:::my-bucket/*"
        }
    ]
}

# Users are assigned to Groups (Roles)
# Groups have Policies (Permissions) attached</code></pre>
            </div>
        </div>

        <div class="section">
            <h2>Python Implementation</h2>

            <h3>Simple RBAC System</h3>
            <pre><code class="language-python">from enum import Enum
from dataclasses import dataclass, field
from typing import Set, Optional

class Permission(Enum):
    USER_CREATE = "user:create"
    USER_READ = "user:read"
    USER_DELETE = "user:delete"
    POST_CREATE = "post:create"
    POST_READ = "post:read"
    POST_DELETE = "post:delete"
    ADMIN_PANEL = "admin:panel"


@dataclass
class Role:
    name: str
    permissions: Set[Permission] = field(default_factory=set)
    parent: Optional['Role'] = None  # For hierarchy

    def get_all_permissions(self) -> Set[Permission]:
        """Get permissions including inherited ones."""
        perms = self.permissions.copy()
        if self.parent:
            perms.update(self.parent.get_all_permissions())
        return perms


@dataclass
class User:
    id: str
    username: str
    roles: Set[Role] = field(default_factory=set)

    def has_permission(self, permission: Permission) -> bool:
        """Check if user has a specific permission."""
        for role in self.roles:
            if permission in role.get_all_permissions():
                return True
        return False</code></pre>

            <h3>Flask Decorator for RBAC</h3>
            <pre><code class="language-python">from functools import wraps
from flask import abort

def require_permission(permission: Permission):
    """Decorator to check if user has required permission."""
    def decorator(f):
        @wraps(f)
        def decorated_function(*args, **kwargs):
            user = get_current_user()

            if not user:
                abort(401)  # Not authenticated

            if not user.has_permission(permission):
                abort(403)  # Not authorized

            return f(*args, **kwargs)
        return decorated_function
    return decorator


# Usage
@app.route('/admin/users', methods=['DELETE'])
@require_permission(Permission.USER_DELETE)
def delete_user():
    # Only users with USER_DELETE permission can access
    return {"status": "user deleted"}</code></pre>
        </div>

        <div class="section">
            <h2>Database Schema</h2>

            <pre><code class="language-sql">-- Users table
CREATE TABLE users (
    id SERIAL PRIMARY KEY,
    username VARCHAR(50) UNIQUE NOT NULL,
    email VARCHAR(100) UNIQUE NOT NULL
);

-- Roles table (with hierarchy support)
CREATE TABLE roles (
    id SERIAL PRIMARY KEY,
    name VARCHAR(50) UNIQUE NOT NULL,
    parent_role_id INTEGER REFERENCES roles(id)
);

-- Permissions table
CREATE TABLE permissions (
    id SERIAL PRIMARY KEY,
    name VARCHAR(100) UNIQUE NOT NULL  -- e.g., "user:create"
);

-- Role-Permission mapping (many-to-many)
CREATE TABLE role_permissions (
    role_id INTEGER REFERENCES roles(id),
    permission_id INTEGER REFERENCES permissions(id),
    PRIMARY KEY (role_id, permission_id)
);

-- User-Role mapping (many-to-many)
CREATE TABLE user_roles (
    user_id INTEGER REFERENCES users(id),
    role_id INTEGER REFERENCES roles(id),
    PRIMARY KEY (user_id, role_id)
);</code></pre>
        </div>

        <div class="section">
            <h2>Best Practices</h2>

            <div class="card-grid">
                <div class="card" style="cursor: default; border-color: #51cf66;">
                    <div class="card-icon">ğŸ¯</div>
                    <h3>Least Privilege</h3>
                    <p>Give minimum permissions needed. Don't assign "admin" just in case.</p>
                </div>
                <div class="card" style="cursor: default; border-color: #51cf66;">
                    <div class="card-icon">ğŸ”€</div>
                    <h3>Separation of Duties</h3>
                    <p>Same person can't be Requester AND Approver (prevents fraud).</p>
                </div>
                <div class="card" style="cursor: default; border-color: #51cf66;">
                    <div class="card-icon">ğŸ“‹</div>
                    <h3>Regular Audits</h3>
                    <p>Review who has what access periodically. Remove stale permissions.</p>
                </div>
                <div class="card" style="cursor: default; border-color: #51cf66;">
                    <div class="card-icon">ğŸš«</div>
                    <h3>Default Deny</h3>
                    <p>If permission isn't explicitly granted, it's denied.</p>
                </div>
            </div>
        </div>

        <div class="section">
            <h2>Common Pitfalls</h2>

            <div class="comparison-grid">
                <div class="comparison-item bad">
                    <h4>âŒ Role Explosion</h4>
                    <pre><code class="language-text">viewer_posts_only
viewer_posts_and_comments
viewer_posts_comments_profiles
editor_posts_only
... (100 more roles)</code></pre>
                    <p>Too many granular roles!</p>
                </div>
                <div class="comparison-item good">
                    <h4>âœ… Permission Composition</h4>
                    <pre><code class="language-text">viewer (base)
editor (base + edit perms)
+ resource-specific permissions</code></pre>
                    <p>Compose roles from permissions</p>
                </div>
            </div>

            <div class="comparison-grid">
                <div class="comparison-item bad">
                    <h4>âŒ Hardcoded Role Checks</h4>
                    <pre><code class="language-python"># Checking role names directly
if user.role == "admin":
    allow_delete()</code></pre>
                </div>
                <div class="comparison-item good">
                    <h4>âœ… Permission-Based Checks</h4>
                    <pre><code class="language-python"># Checking permissions
if user.has_permission(DELETE):
    allow_delete()</code></pre>
                </div>
            </div>
        </div>

        <!-- Quiz -->
        <div class="quiz-container">
            <div class="quiz-title">ğŸ§  Quiz: RBAC Knowledge</div>
            <p style="margin-bottom: 1rem;">In RBAC, permissions are assigned to:</p>
            <div class="quiz-options">
                <div class="quiz-option" onclick="checkAnswer(this, false)">
                    A) Users directly
                </div>
                <div class="quiz-option" onclick="checkAnswer(this, true)">
                    B) Roles, and users are assigned to roles
                </div>
                <div class="quiz-option" onclick="checkAnswer(this, false)">
                    C) Resources like files and databases
                </div>
                <div class="quiz-option" onclick="checkAnswer(this, false)">
                    D) Sessions
                </div>
            </div>
            <div class="quiz-feedback" id="quiz-feedback"></div>
        </div>

        <div class="page-nav">
            <a href="07_cheatsheet.html">&larr; Cheat Sheet</a>
            <a href="index.html">Back to Home &rarr;</a>
        </div>

        <footer>
            <p>Page 8 of 8 - Authentication Guide</p>
        </footer>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-sql.min.js"></script>
    <script>
        function checkAnswer(element, isCorrect) {
            const options = document.querySelectorAll('.quiz-option');
            const feedback = document.getElementById('quiz-feedback');
            options.forEach(opt => {
                opt.classList.add('disabled');
                if (opt.onclick.toString().includes('true')) {
                    opt.classList.add('correct');
                }
            });
            if (isCorrect) {
                element.classList.add('correct');
                feedback.className = 'quiz-feedback show correct';
                feedback.innerHTML = 'âœ… Correct! In RBAC, permissions are assigned to roles, and users are assigned to roles. This indirection makes permission management scalable!';
            } else {
                element.classList.add('incorrect');
                feedback.className = 'quiz-feedback show incorrect';
                feedback.innerHTML = 'âŒ Not quite. RBAC assigns permissions to ROLES, not directly to users. Users get permissions by being assigned to roles.';
            }
        }
    </script>
</body>
</html>
