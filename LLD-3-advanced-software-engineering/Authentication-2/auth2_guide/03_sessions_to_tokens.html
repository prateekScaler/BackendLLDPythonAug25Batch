<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sessions to Tokens - Auth Guide 2</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Fira+Code:wght@400;500&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <nav class="navbar">
        <div class="navbar-content">
            <a href="index.html" class="navbar-brand">ğŸ” Auth Guide 2</a>
            <div class="navbar-nav">
                <a href="index.html" class="nav-btn">Home</a>
                <a href="08_cheatsheet.html" class="nav-btn">Cheat Sheet</a>
            </div>
        </div>
    </nav>

    <div class="container">
        <header class="page-header">
            <div class="page-icon">ğŸª â†’ ğŸŸï¸</div>
            <h1>From Sessions to Tokens</h1>
            <p class="subtitle">Why we need a new approach for modern apps</p>
        </header>

        <div class="section">
            <h2>Session-Based Authentication (Recap)</h2>

            <div class="diagram">
<pre>
SESSION-BASED AUTHENTICATION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Browser          Server           Session Store (Redis)
   â”‚                â”‚                    â”‚
   â”‚â”€â”€ Login â”€â”€â”€â”€â”€â”€â–ºâ”‚                    â”‚
   â”‚                â”‚â”€â”€ Create session â”€â–ºâ”‚
   â”‚                â”‚   {user_id: 42}    â”‚
   â”‚                â”‚â—„â”€â”€ session_id â”€â”€â”€â”€â”€â”‚
   â”‚â—„â”€â”€ Cookie â”€â”€â”€â”€â”€â”‚                    â”‚
   â”‚   (session_id) â”‚                    â”‚
   â”‚                â”‚                    â”‚
   â”‚â”€â”€ Request â”€â”€â”€â”€â–ºâ”‚                    â”‚
   â”‚   + Cookie     â”‚â”€â”€ Lookup â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
   â”‚                â”‚â—„â”€â”€ User data â”€â”€â”€â”€â”€â”€â”‚
   â”‚â—„â”€â”€ Response â”€â”€â”€â”‚                    â”‚
</pre>
            </div>

            <div class="card-grid">
                <div class="card" style="cursor: default; border-color: #51cf66;">
                    <div class="card-icon">âœ…</div>
                    <h3>Pros</h3>
                    <ul style="text-align: left; font-size: 0.9rem;">
                        <li>Easy to invalidate (delete session)</li>
                        <li>Server has full control</li>
                        <li>Smaller cookie size</li>
                    </ul>
                </div>
                <div class="card" style="cursor: default; border-color: #ff6b6b;">
                    <div class="card-icon">âŒ</div>
                    <h3>Cons</h3>
                    <ul style="text-align: left; font-size: 0.9rem;">
                        <li>Server must store all sessions</li>
                        <li>Scaling needs shared store</li>
                        <li>DB lookup on every request</li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="section">
            <h2>The Modern Challenge</h2>

            <div class="info-box">
                <strong>New requirements that sessions struggle with:</strong>
            </div>

            <div class="card-grid">
                <div class="card" style="cursor: default;">
                    <div class="card-icon">ğŸ“±</div>
                    <h3>Mobile Apps</h3>
                    <p>Cookies don't work naturally in mobile. Apps prefer tokens in headers.</p>
                </div>
                <div class="card" style="cursor: default;">
                    <div class="card-icon">ğŸ”Œ</div>
                    <h3>Microservices</h3>
                    <p>Multiple services need to verify users. Sharing session store is complex.</p>
                </div>
                <div class="card" style="cursor: default;">
                    <div class="card-icon">ğŸŒ</div>
                    <h3>SPAs (Single Page Apps)</h3>
                    <p>React/Vue apps often have separate backend. CORS + cookies = pain.</p>
                </div>
                <div class="card" style="cursor: default;">
                    <div class="card-icon">ğŸ”—</div>
                    <h3>Third-Party APIs</h3>
                    <p>Your API consumed by others. They can't use your session store.</p>
                </div>
            </div>
        </div>

        <!-- Mobile Apps Deep Dive -->
        <div class="section">
            <h2>Challenge 1: Mobile Apps</h2>

            <div class="diagram">
<pre>
WHY COOKIES DON'T WORK WELL ON MOBILE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Web Browser:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Browser has built-in "Cookie Jar"      â”‚
â”‚                                        â”‚
â”‚ Cookies are:                           â”‚
â”‚ â€¢ Automatically stored                 â”‚
â”‚ â€¢ Automatically sent with requests     â”‚
â”‚ â€¢ Managed by browser (expiry, domain)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Mobile App (iOS/Android):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ NO built-in cookie handling!           â”‚
â”‚                                        â”‚
â”‚ Developers must:                       â”‚
â”‚ â€¢ Manually store cookies (KeyChain/SP) â”‚
â”‚ â€¢ Manually attach to requests          â”‚
â”‚ â€¢ Handle cookie parsing themselves     â”‚
â”‚ â€¢ Worry about cookie domains manually  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

MUCH EASIER: Just send a token in the header!

Authorization: Bearer eyJhbGciOiJIUzI1NiJ9...
</pre>
            </div>

            <h3>Real Example: Swiggy App</h3>

            <div class="diagram">
<pre>
SWIGGY MOBILE APP ARCHITECTURE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

When you open Swiggy app:

1. Login with phone number
   App â”€â”€â–º POST /login {phone, otp}
       â—„â”€â”€ {"access_token": "eyJ...", "refresh_token": "..."}

2. Store token securely
   iOS: Keychain (encrypted storage)
   Android: Encrypted SharedPreferences

3. Every API call includes token:
   App â”€â”€â–º GET /restaurants
          Header: Authorization: Bearer eyJ...
       â—„â”€â”€ [restaurant list]

   App â”€â”€â–º POST /order
          Header: Authorization: Bearer eyJ...
       â—„â”€â”€ {"order_id": "12345"}

No cookies! Just headers with tokens.
Works seamlessly across app restarts.
</pre>
            </div>
        </div>

        <!-- Microservices Deep Dive -->
        <div class="section">
            <h2>Challenge 2: Microservices Architecture</h2>

            <div class="diagram">
<pre>
MONOLITH (Sessions Work Fine)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              SINGLE SERVER                   â”‚
â”‚                                             â”‚
â”‚  User â”€â”€â–º API Gateway â”€â”€â–º Session Store     â”‚
â”‚                              â†“               â”‚
â”‚                         User Service         â”‚
â”‚                         Order Service        â”‚
â”‚                         Payment Service      â”‚
â”‚                                             â”‚
â”‚  ONE session store, ALL services access it  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


MICROSERVICES (Sessions Get Complicated)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                         â”‚
â”‚  User â”€â”€â–º API Gateway                                   â”‚
â”‚              â”‚                                          â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚
â”‚     â†“        â†“        â†“                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚  â”‚User  â”‚ â”‚Order â”‚ â”‚Paymentâ”‚                           â”‚
â”‚  â”‚Svc   â”‚ â”‚Svc   â”‚ â”‚Svc   â”‚                           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â”‚     â”‚        â”‚        â”‚                                â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â–º Session Store ???       â”‚
â”‚                                                         â”‚
â”‚  Each service needs to verify "Is this user logged in?"â”‚
â”‚  Should all services access the same Redis?            â”‚
â”‚  What if services are in different data centers?       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</pre>
            </div>

            <h3>The Session Problem with Microservices</h3>

            <div class="table-container">
                <table>
                    <tr>
                        <th>Challenge</th>
                        <th>With Sessions</th>
                        <th>With Tokens (JWT)</th>
                    </tr>
                    <tr>
                        <td>Cross-service auth</td>
                        <td>Every service needs Redis access</td>
                        <td>Each service verifies token locally</td>
                    </tr>
                    <tr>
                        <td>Network latency</td>
                        <td>Redis call on EVERY request</td>
                        <td>No network call (verify signature)</td>
                    </tr>
                    <tr>
                        <td>Single point of failure</td>
                        <td>Redis down = all services affected</td>
                        <td>No dependency, services work independently</td>
                    </tr>
                    <tr>
                        <td>Scaling</td>
                        <td>Redis cluster needed</td>
                        <td>Just share the secret key</td>
                    </tr>
                </table>
            </div>

            <h3>Real Example: Netflix Architecture</h3>

            <div class="diagram">
<pre>
NETFLIX MICROSERVICES (Simplified)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

User opens Netflix:
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”Œâ”€â”€â”€â–ºâ”‚ Content Service â”‚ (What can you watch?)
                    â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”   Token    â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”œâ”€â”€â”€â–ºâ”‚ Profile Service â”‚ (Who's watching?)
â””â”€â”€â”€â”€â”€â”€â”˜            â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â””â”€â”€â”€â–ºâ”‚ Playback Serviceâ”‚ (Stream the video)
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Each service receives the JWT token
Each service verifies the signature independently
Each service extracts user_id from payload
NO shared session store needed!
</pre>
            </div>
        </div>

        <!-- SPA Deep Dive -->
        <div class="section">
            <h2>Challenge 3: Single Page Applications (SPAs)</h2>

            <div class="diagram">
<pre>
TRADITIONAL WEB APP (Sessions Easy)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Same origin - cookies work automatically:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  https://myapp.com                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   Frontend  â”‚  â”‚    Backend      â”‚ â”‚
â”‚  â”‚   (HTML)    â”‚â”€â”€â”‚    (API)        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚        Cookie flows automatically     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


MODERN SPA (Sessions Problematic)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Different origins - CORS + Cookies = headache:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ https://app.mysite.comâ”‚     â”‚ https://api.mysite.comâ”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚     â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚   React/Vue App   â”‚ â”‚â”€â”€â”€â”€â–ºâ”‚ â”‚    REST API       â”‚ â”‚
â”‚ â”‚   (Frontend)      â”‚ â”‚     â”‚ â”‚    (Backend)      â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚     â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       Different subdomain = Different origin!

Problems:
â€¢ Need CORS configuration
â€¢ Need credentials: 'include'
â€¢ SameSite cookie restrictions
â€¢ Can't use wildcard origins with credentials
</pre>
            </div>

            <h3>Real Example: React + Flask Setup</h3>

            <pre><code class="language-javascript">// React Frontend (app.mysite.com)

// WITH SESSIONS - Complex setup
fetch('https://api.mysite.com/data', {
    method: 'GET',
    credentials: 'include',  // Required for cookies!
    headers: {
        'Content-Type': 'application/json'
    }
});

// WITH TOKENS - Simple and clean
fetch('https://api.mysite.com/data', {
    method: 'GET',
    headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${localStorage.getItem('token')}`
    }
});

// Token approach: No credentials config, no CORS cookie headaches!</code></pre>
        </div>

        <!-- Third-Party APIs Deep Dive -->
        <div class="section">
            <h2>Challenge 4: Third-Party API Access</h2>

            <div class="diagram">
<pre>
YOUR API CONSUMED BY EXTERNAL CLIENTS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

You build an API like Razorpay:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  External developers want to use your API:         â”‚
â”‚                                                    â”‚
â”‚  â€¢ E-commerce sites (process payments)             â”‚
â”‚  â€¢ Mobile apps (in-app purchases)                  â”‚
â”‚  â€¢ Backend services (subscription billing)         â”‚
â”‚  â€¢ IoT devices (smart POS terminals)               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

With Sessions:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  External App â”€â”€â–º "Here's my session cookie"        â”‚
â”‚                                                     â”‚
â”‚  Your API: "What session? You don't have access    â”‚
â”‚             to MY Redis server!"                    â”‚
â”‚                                                     â”‚
â”‚  Sessions are SERVER-SIDE. External apps can't     â”‚
â”‚  share your session store!                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

With Tokens (JWT or API Key):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  External App â”€â”€â–º "Here's my API token"             â”‚
â”‚                   Authorization: Bearer rzp_xxx     â”‚
â”‚                                                     â”‚
â”‚  Your API: Verifies token signature âœ“               â”‚
â”‚            Extracts merchant_id âœ“                   â”‚
â”‚            Processes request âœ“                      â”‚
â”‚                                                     â”‚
â”‚  No shared state needed!                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</pre>
            </div>

            <h3>How Razorpay/Stripe APIs Work</h3>

            <pre><code class="language-python"># External developer using Razorpay API

import requests

# API Key acts as a token - no sessions involved!
api_key = "rzp_test_xxxxxxxxxxxxx"
secret = "yyyyyyyyyyyyyy"

response = requests.post(
    "https://api.razorpay.com/v1/orders",
    auth=(api_key, secret),  # Token in header (Basic Auth)
    json={
        "amount": 50000,  # Amount in paise
        "currency": "INR",
        "receipt": "order_123"
    }
)

# Razorpay verifies the API key
# No session lookup needed
# Works from anywhere in the world!</code></pre>

            <div class="success-box">
                <strong>Key Insight:</strong> Public APIs almost NEVER use sessions. They use API keys, JWT tokens, or OAuth tokens because external clients can't share your session store.
            </div>
        </div>

        <!-- Quiz: Modern Challenges -->
        <div class="quiz-container">
            <div class="quiz-title">ğŸ¤” Think About It</div>
            <p style="margin-bottom: 1rem;">A company is building a food delivery platform with:</p>
            <ul style="margin-bottom: 1rem; padding-left: 1.5rem;">
                <li>iOS and Android mobile apps</li>
                <li>Web dashboard for restaurant owners</li>
                <li>Separate microservices for orders, payments, delivery tracking</li>
                <li>Public API for restaurant POS integration</li>
            </ul>
            <p style="margin-bottom: 1rem;">Should they use session-based or token-based authentication?</p>
            <div class="quiz-options">
                <div class="quiz-option" onclick="checkAnswer2(this, false)">
                    A) Session-based - it's more secure
                </div>
                <div class="quiz-option" onclick="checkAnswer2(this, true)">
                    B) Token-based (JWT) - fits all their use cases
                </div>
                <div class="quiz-option" onclick="checkAnswer2(this, false)">
                    C) Basic authentication with username/password
                </div>
                <div class="quiz-option" onclick="checkAnswer2(this, false)">
                    D) No authentication needed
                </div>
            </div>
            <div class="quiz-feedback" id="quiz-feedback-2"></div>
        </div>

        <script>
        function checkAnswer2(element, isCorrect) {
            const container = element.closest('.quiz-container');
            const options = container.querySelectorAll('.quiz-option');
            const feedback = container.querySelector('.quiz-feedback');
            options.forEach(opt => {
                opt.classList.add('disabled');
                if (opt.onclick.toString().includes('true')) {
                    opt.classList.add('correct');
                }
            });
            if (isCorrect) {
                element.classList.add('correct');
                feedback.className = 'quiz-feedback show correct';
                feedback.innerHTML = 'âœ… Correct! Tokens are ideal because: Mobile apps need headers not cookies, microservices can verify tokens independently, and public APIs need stateless authentication.';
            } else {
                element.classList.add('incorrect');
                feedback.className = 'quiz-feedback show incorrect';
                feedback.innerHTML = 'âŒ Token-based auth (JWT) is better for this scenario. Mobile apps, microservices, and public APIs all benefit from stateless, token-based authentication.';
            }
        }
        </script>

        <div class="section">
            <h2>The Token-Based Solution</h2>

            <div class="diagram">
<pre>
TOKEN-BASED AUTHENTICATION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Browser/App          Server
   â”‚                    â”‚
   â”‚â”€â”€ Login â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
   â”‚                    â”‚  Generate signed token
   â”‚                    â”‚  (contains user data)
   â”‚â—„â”€â”€ Token â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
   â”‚   (store locally)  â”‚
   â”‚                    â”‚
   â”‚â”€â”€ Request â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
   â”‚   + Token          â”‚  Verify signature
   â”‚   (in header)      â”‚  (NO DB lookup!)
   â”‚â—„â”€â”€ Response â”€â”€â”€â”€â”€â”€â”€â”‚

Server stores: NOTHING! (Stateless)
</pre>
            </div>

            <div class="success-box">
                <strong>Key Insight:</strong> The token itself contains all the information the server needs. No lookup required!
            </div>
        </div>

        <div class="section">
            <h2>Side-by-Side Comparison</h2>

            <div class="table-container">
                <table>
                    <tr>
                        <th>Aspect</th>
                        <th>Session-Based</th>
                        <th>Token-Based (JWT)</th>
                    </tr>
                    <tr>
                        <td><strong>Server stores</strong></td>
                        <td>Session data</td>
                        <td>Nothing (stateless)</td>
                    </tr>
                    <tr>
                        <td><strong>Client stores</strong></td>
                        <td>Session ID (cookie)</td>
                        <td>Full token</td>
                    </tr>
                    <tr>
                        <td><strong>Sent via</strong></td>
                        <td>Cookie (automatic)</td>
                        <td>Header (Authorization: Bearer)</td>
                    </tr>
                    <tr>
                        <td><strong>Scaling</strong></td>
                        <td>Needs shared store (Redis)</td>
                        <td>Easy (no shared state)</td>
                    </tr>
                    <tr>
                        <td><strong>Revocation</strong></td>
                        <td>Easy (delete session)</td>
                        <td>Hard (token is self-contained)</td>
                    </tr>
                    <tr>
                        <td><strong>Mobile-friendly</strong></td>
                        <td>Not naturally</td>
                        <td>Yes</td>
                    </tr>
                    <tr>
                        <td><strong>Cross-origin</strong></td>
                        <td>Complex (CORS)</td>
                        <td>Easy</td>
                    </tr>
                </table>
            </div>
        </div>

        <div class="section">
            <h2>When to Use What?</h2>

            <div class="comparison-grid">
                <div class="comparison-item" style="background: #e7f5ff; border: 2px solid #339af0;">
                    <h4>ğŸª Use Sessions When</h4>
                    <ul>
                        <li>Traditional server-rendered web app</li>
                        <li>Need instant session revocation</li>
                        <li>Single server or easy Redis setup</li>
                        <li>Browser-only access</li>
                    </ul>
                    <p style="margin-top: 1rem; font-style: italic;">Examples: Scaler, Amazon, most e-commerce sites</p>
                </div>
                <div class="comparison-item" style="background: #d3f9d8; border: 2px solid #51cf66;">
                    <h4>ğŸŸï¸ Use Tokens (JWT) When</h4>
                    <ul>
                        <li>Mobile apps</li>
                        <li>SPAs with separate API</li>
                        <li>Microservices architecture</li>
                        <li>Public API for third parties</li>
                    </ul>
                    <p style="margin-top: 1rem; font-style: italic;">Examples: GitHub API, Stripe, Auth0</p>
                </div>
            </div>
        </div>

        <div class="section">
            <h2>The Journey Ahead</h2>

            <div class="diagram">
<pre>
TODAY'S ROADMAP
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Sessions   â”‚â”€â”€â”€â”€â–ºâ”‚    JWT      â”‚â”€â”€â”€â”€â–ºâ”‚  OAuth 2.0  â”‚
â”‚  (Recap)    â”‚     â”‚  (Tokens)   â”‚     â”‚  (Delegation)â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                   â”‚                   â”‚
       â–¼                   â–¼                   â–¼
   "Server              "Stateless        "Login with
    remembers"          authentication"    Google/GitHub"
</pre>
            </div>
        </div>

        <!-- Quiz -->
        <div class="quiz-container">
            <div class="quiz-title">ğŸ§  Quick Check</div>
            <p style="margin-bottom: 1rem;">A mobile app needs to authenticate users. What's the better approach?</p>
            <div class="quiz-options">
                <div class="quiz-option" onclick="checkAnswer(this, false)">
                    A) Session-based with cookies
                </div>
                <div class="quiz-option" onclick="checkAnswer(this, true)">
                    B) Token-based (JWT) with Authorization header
                </div>
                <div class="quiz-option" onclick="checkAnswer(this, false)">
                    C) Send username/password with every request
                </div>
                <div class="quiz-option" onclick="checkAnswer(this, false)">
                    D) No authentication needed for mobile
                </div>
            </div>
            <div class="quiz-feedback" id="quiz-feedback"></div>
        </div>

        <div class="page-nav">
            <a href="02_bcrypt_recap.html">â† BCrypt Recap</a>
            <a href="04_jwt_intro.html">Next: JWT Introduction â†’</a>
        </div>

        <footer>
            <p>Page 3 of 9 - Auth Guide 2</p>
        </footer>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script>
        function checkAnswer(element, isCorrect) {
            const options = document.querySelectorAll('.quiz-option');
            const feedback = document.getElementById('quiz-feedback');
            options.forEach(opt => {
                opt.classList.add('disabled');
                if (opt.onclick.toString().includes('true')) {
                    opt.classList.add('correct');
                }
            });
            if (isCorrect) {
                element.classList.add('correct');
                feedback.className = 'quiz-feedback show correct';
                feedback.innerHTML = 'âœ… Correct! Mobile apps work better with tokens sent in headers (Authorization: Bearer). Cookies are awkward on mobile.';
            } else {
                element.classList.add('incorrect');
                feedback.className = 'quiz-feedback show incorrect';
                feedback.innerHTML = 'âŒ Not quite. Token-based auth with JWT is the standard for mobile apps since they can easily store and send tokens in request headers.';
            }
        }
    </script>
</body>
</html>
