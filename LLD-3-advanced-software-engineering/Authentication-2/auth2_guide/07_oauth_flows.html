<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OAuth 2.0 Flows - Auth Guide 2</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Fira+Code:wght@400;500&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <style>
        .flow-card {
            background: var(--bg-primary);
            border-radius: 16px;
            padding: 2rem;
            margin: 1.5rem 0;
            border: 2px solid var(--border-color);
        }
        .flow-card.recommended {
            border-color: #51cf66;
            background: linear-gradient(135deg, #d3f9d8 0%, #b2f2bb 100%);
        }
        .flow-title {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }
        .flow-badge {
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 600;
        }
        .badge-recommended { background: #51cf66; color: white; }
        .badge-legacy { background: #868e96; color: white; }
        .badge-machine { background: #339af0; color: white; }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="navbar-content">
            <a href="index.html" class="navbar-brand">ğŸ” Auth Guide 2</a>
            <div class="navbar-nav">
                <a href="index.html" class="nav-btn">Home</a>
                <a href="08_cheatsheet.html" class="nav-btn">Cheat Sheet</a>
            </div>
        </div>
    </nav>

    <div class="container">
        <header class="page-header">
            <div class="page-icon">ğŸ”„</div>
            <h1>OAuth 2.0 Flows</h1>
            <p class="subtitle">Different flows for different use cases</p>
        </header>

        <div class="section">
            <h2>Which Flow to Use?</h2>

            <div class="think-prompt">
                <div class="think-prompt-icon">ğŸ¤”</div>
                <div class="think-prompt-content">
                    <strong>Think First!</strong>
                    <p>For each use case, consider: Does the client have a backend server? Can it keep secrets? Is there a user involved?</p>
                </div>
            </div>

            <button class="reveal-all-btn" onclick="revealAllCells('oauth-flows-table')">
                ğŸ‘ï¸ Reveal All Answers
            </button>

            <div class="table-container">
                <table class="interactive-table" id="oauth-flows-table">
                    <tr>
                        <th>Use Case</th>
                        <th>Recommended Flow (Click to reveal)</th>
                    </tr>
                    <tr>
                        <td>Web app with backend server</td>
                        <td class="hidden-cell" onclick="revealCell(this)"><span class="cell-content"><strong>Authorization Code</strong></span></td>
                    </tr>
                    <tr>
                        <td>Mobile app / SPA</td>
                        <td class="hidden-cell" onclick="revealCell(this)"><span class="cell-content"><strong>Authorization Code + PKCE</strong></span></td>
                    </tr>
                    <tr>
                        <td>Server-to-server (no user)</td>
                        <td class="hidden-cell" onclick="revealCell(this)"><span class="cell-content"><strong>Client Credentials</strong></span></td>
                    </tr>
                    <tr>
                        <td>Legacy/trusted apps only</td>
                        <td class="hidden-cell" onclick="revealCell(this)"><span class="cell-content">Implicit (deprecated - avoid!)</span></td>
                    </tr>
                </table>
            </div>
        </div>

        <!-- Authorization Code Flow -->
        <div class="flow-card recommended">
            <div class="flow-title">
                <h2 style="margin: 0;">1. Authorization Code Flow</h2>
                <span class="flow-badge badge-recommended">RECOMMENDED</span>
            </div>
            <p><strong>Use for:</strong> Web applications with a backend server</p>
            <p><strong>Real Example:</strong> Zomato's "Login with Google" button</p>

            <div class="diagram">
<pre style="font-size: 0.9rem; line-height: 1.4;">
AUTHORIZATION CODE FLOW â€” Example: Zomato + Google Login
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

     YOU                    ZOMATO                    GOOGLE                  GOOGLE APIs
   (Browser)            (Backend Server)          (Auth Server)           (Resource Server)
      â”‚                        â”‚                        â”‚                        â”‚
      â”‚                        â”‚                        â”‚                        â”‚
 â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
 â”‚  User   â”‚              â”‚ Zomato  â”‚              â”‚ Google  â”‚              â”‚ Google  â”‚
 â”‚ (Sumit) â”‚              â”‚ Server  â”‚              â”‚ OAuth   â”‚              â”‚ User    â”‚
 â”‚         â”‚              â”‚         â”‚              â”‚         â”‚              â”‚ Info APIâ”‚
 â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
      â”‚                        â”‚                        â”‚                        â”‚
      â”‚ 1. Click               â”‚                        â”‚                        â”‚
      â”‚ "Login with Google"    â”‚                        â”‚                        â”‚
      â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                        â”‚                        â”‚
      â”‚                        â”‚                        â”‚                        â”‚
      â”‚ 2. Redirect to         â”‚                        â”‚                        â”‚
      â”‚    Google login page   â”‚                        â”‚                        â”‚
      â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                        â”‚                        â”‚
      â”‚                        â”‚                        â”‚                        â”‚
      â”‚ 3. You see Google:     â”‚                        â”‚                        â”‚
      â”‚    "Zomato wants to    â”‚                        â”‚                        â”‚
      â”‚     see your email"    â”‚                        â”‚                        â”‚
      â”‚    [Allow] [Deny]      â”‚                        â”‚                        â”‚
      â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                        â”‚
      â”‚                        â”‚                        â”‚                        â”‚
      â”‚ 4. Google redirects    â”‚                        â”‚                        â”‚
      â”‚    back with CODE      â”‚                        â”‚                        â”‚
      â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                        â”‚
      â”‚   zomato.com/callback?code=4xF7g...            â”‚                        â”‚
      â”‚                        â”‚                        â”‚                        â”‚
      â”‚ 5. Browser sends       â”‚                        â”‚                        â”‚
      â”‚    CODE to Zomato      â”‚                        â”‚                        â”‚
      â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                        â”‚                        â”‚
      â”‚                        â”‚                        â”‚                        â”‚
      â”‚                        â”‚ 6. Zomato exchanges   â”‚                        â”‚
      â”‚                        â”‚    CODE + secret      â”‚                        â”‚
      â”‚                        â”‚    for TOKENS         â”‚                        â”‚
      â”‚                        â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                        â”‚
      â”‚                        â”‚                        â”‚                        â”‚
      â”‚                        â”‚ 7. Google sends       â”‚                        â”‚
      â”‚                        â”‚    access_token +     â”‚                        â”‚
      â”‚                        â”‚    id_token (JWT)     â”‚                        â”‚
      â”‚                        â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                        â”‚
      â”‚                        â”‚                        â”‚                        â”‚
      â”‚                        â”‚ 8. Zomato decodes     â”‚                        â”‚
      â”‚                        â”‚    id_token â†’ gets    â”‚                        â”‚
      â”‚                        â”‚    email, name        â”‚                        â”‚
      â”‚                        â”‚    (or calls API)     â”‚                        â”‚
      â”‚                        â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
      â”‚                        â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
      â”‚                        â”‚                        â”‚                        â”‚
      â”‚ 9. "Welcome, Sumit!"   â”‚                        â”‚                        â”‚
      â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                        â”‚                        â”‚
      â”‚                        â”‚                        â”‚                        â”‚
</pre>
            </div>

            <div class="success-box">
                <strong>Why it's secure:</strong> The <code>client_secret</code> is only sent server-to-server (Step 6),
                never exposed to the browser. Even if someone intercepts the CODE, they can't get tokens without the secret!
            </div>

            <!-- Deep Dive: Code and Secret -->
            <details class="deep-dive" style="margin-top: 1.5rem; background: white; border-radius: 12px; padding: 1.5rem; border: 2px solid #69db7c;">
                <summary style="cursor: pointer; font-weight: 700; font-size: 1.1rem; color: #2f9e44;">
                    ğŸ” Deep Dive: What are CODE and SECRET? Who stores what?
                </summary>
                <div style="margin-top: 1rem;">
                    <h4 style="color: #1971c2; margin-bottom: 0.75rem;">The Two Key Players:</h4>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1.5rem;">
                        <div style="background: #e7f5ff; padding: 1rem; border-radius: 8px; border-left: 4px solid #339af0;">
                            <strong style="color: #1971c2;">Authorization CODE</strong>
                            <p style="margin: 0.5rem 0 0 0; font-size: 0.9rem;">
                                A <strong>one-time, short-lived</strong> ticket (typically expires in 1-10 minutes).<br><br>
                                <em>Think:</em> Like a movie ticket stub that can only be exchanged once at the counter.
                            </p>
                        </div>
                        <div style="background: #fff3bf; padding: 1rem; border-radius: 8px; border-left: 4px solid #fab005;">
                            <strong style="color: #e67700;">Client SECRET</strong>
                            <p style="margin: 0.5rem 0 0 0; font-size: 0.9rem;">
                                A <strong>permanent password</strong> that proves Zomato is really Zomato.<br><br>
                                <em>Think:</em> Like the company's official stamp/seal that verifies authenticity.
                            </p>
                        </div>
                    </div>

                    <h4 style="color: #1971c2; margin-bottom: 0.75rem;">Who Stores What & Where?</h4>
                    <div class="diagram" style="background: #f8f9fa; padding: 1rem; border-radius: 8px; font-size: 0.85rem;">
<pre style="margin: 0;">
WHO STORES WHAT?
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              GOOGLE (Auth Provider)                         â”‚
â”‚                                                                             â”‚
â”‚   Stores permanently:                                                       â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚ client_id: "zomato-12345"                                           â”‚   â”‚
â”‚   â”‚ client_secret: "super-secret-xyz" (hashed)                          â”‚   â”‚
â”‚   â”‚ redirect_uri: "https://zomato.com/callback" (whitelisted)           â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚   Stores temporarily (1-10 min):                                            â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚ code: "4xF7g..." â†’ linked to â†’ user_id: "sumit@gmail.com"           â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            ZOMATO (Your App's Server)                       â”‚
â”‚                                                                             â”‚
â”‚   Stores permanently (in environment variables, NOT in code!):              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚ GOOGLE_CLIENT_ID = "zomato-12345"                                   â”‚   â”‚
â”‚   â”‚ GOOGLE_CLIENT_SECRET = "super-secret-xyz"  â† NEVER in frontend!     â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚   After successful auth, stores:                                            â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚ user_id: 42                                                         â”‚   â”‚
â”‚   â”‚ google_access_token: "ya29.xxx" (encrypted)                         â”‚   â”‚
â”‚   â”‚ google_refresh_token: "1//0eXxx" (encrypted)                        â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            USER'S BROWSER                                   â”‚
â”‚                                                                             â”‚
â”‚   Sees temporarily (in URL, for milliseconds):                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚ zomato.com/callback?code=4xF7g...                                   â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚   NEVER sees: client_secret, access_token, refresh_token                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</pre>
                    </div>

                    <h4 style="color: #1971c2; margin: 1rem 0 0.75rem 0;">Why This Two-Step Dance?</h4>
                    <div style="background: #fff9db; padding: 1rem; border-radius: 8px; border: 1px solid #fab005;">
                        <p style="margin: 0 0 0.75rem 0;"><strong>Why not just send the token directly to the browser?</strong></p>
                        <div class="diagram" style="background: #fff; padding: 1rem; border-radius: 8px; font-size: 0.85rem;">
<pre style="margin: 0;">
INSECURE (Implicit Flow - Deprecated):
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
Browser â”€â”€â–º Google â”€â”€â–º Browser gets TOKEN directly in URL!
                       â†“
            URL: zomato.com/#access_token=xyz123
                       â†“
            Problem: URL is logged in browser history,
                     can be leaked via Referer header,
                     visible in network logs!

SECURE (Authorization Code Flow):
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
Browser â”€â”€â–º Google â”€â”€â–º Browser gets CODE (useless alone)
                       â†“
            Zomato Server + SECRET â”€â”€â–º Google â”€â”€â–º Gets TOKEN
                       â†“
            Token stays on server, never in browser!
</pre>
                        </div>
                        <p style="margin: 0.75rem 0 0 0; font-size: 0.9rem;">
                            <strong>Analogy:</strong> CODE is like a coat check ticket.
                            Anyone can see your ticket number, but only the coat check person (Zomato server)
                            with the employee badge (SECRET) can exchange it for your coat (TOKEN).
                        </p>
                    </div>
                </div>
            </details>
        </div>

        <!-- Authorization Code + PKCE -->
        <div class="flow-card recommended">
            <div class="flow-title">
                <h2 style="margin: 0;">2. Authorization Code + PKCE</h2>
                <span class="flow-badge badge-recommended">RECOMMENDED FOR MOBILE/SPA</span>
            </div>
            <p><strong>Use for:</strong> Mobile apps, Single Page Apps (public clients that can't keep secrets)</p>
            <p><strong>Real Example:</strong> CRED mobile app using "Login with Google"</p>

            <div class="diagram">
<pre style="font-size: 0.85rem; line-height: 1.4;">
PKCE FLOW â€” Example: CRED Mobile App + Google Login
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

THE PROBLEM: Mobile apps can't safely store client_secret
             (anyone can decompile the APK and find it!)

THE SOLUTION: PKCE (Proof Key for Code Exchange)
              Use a one-time secret generated on the fly!


      CRED App                                      GOOGLE
     (on your phone)                            (Auth Server)
          â”‚                                           â”‚
          â”‚                                           â”‚
          â”‚ 1. Generate random string (kept secret)   â”‚
          â”‚    code_verifier = "dBjftJeZ4CVP..."      â”‚
          â”‚                                           â”‚
          â”‚ 2. Hash it                                â”‚
          â”‚    code_challenge = SHA256(verifier)      â”‚
          â”‚                   = "E9Melhoa2OwvFrEMT..."â”‚
          â”‚                                           â”‚
          â”‚ 3. Send ONLY the hash with auth request   â”‚
          â”‚    (code_challenge)                       â”‚
          â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
          â”‚    "Here's a puzzle. I'll prove I made it â”‚
          â”‚     when I come back for tokens."         â”‚
          â”‚                                           â”‚
          â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
          â”‚    CODE = "4/0AX4XfWh..."                 â”‚
          â”‚                                           â”‚
          â”‚ 4. Exchange CODE + original verifier      â”‚
          â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
          â”‚    "Here's the CODE and the answer to     â”‚
          â”‚     the puzzle (code_verifier)"           â”‚
          â”‚                                           â”‚
          â”‚    Google checks:                         â”‚
          â”‚    SHA256("dBjftJeZ4CVP...") ==           â”‚
          â”‚           "E9Melhoa2OwvFrEMT..." âœ“        â”‚
          â”‚                                           â”‚
          â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
          â”‚    access_token + id_token                â”‚
          â”‚                                           â”‚


WHY IT'S SECURE:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â€¢ Even if attacker intercepts the CODE, they don't have the verifier
â€¢ The verifier never travels over the network (only the hash does)
â€¢ It's like a sealed envelope: Google saw the sealed answer first,
  then CRED proves they made it by showing the original
</pre>
            </div>

            <div class="info-box">
                <strong>PKCE in simple terms:</strong> Instead of a pre-shared secret (which mobile apps can't keep safe),
                CRED creates a one-time puzzle. Google sees the answer in a sealed envelope (the hash).
                Later, CRED proves they made the puzzle by showing the original answer.
            </div>

            <!-- Deep Dive: PKCE Explained -->
            <details class="deep-dive" style="margin-top: 1.5rem; background: white; border-radius: 12px; padding: 1.5rem; border: 2px solid #69db7c;">
                <summary style="cursor: pointer; font-weight: 700; font-size: 1.1rem; color: #2f9e44;">
                    ğŸ” Deep Dive: Who generates what? Step-by-step with analogy
                </summary>
                <div style="margin-top: 1rem;">
                    <h4 style="color: #1971c2; margin-bottom: 0.75rem;">Who Does What in PKCE?</h4>

                    <div class="diagram" style="background: #f8f9fa; padding: 1rem; border-radius: 8px; font-size: 0.85rem;">
<pre style="margin: 0;">
PKCE: WHO GENERATES WHAT?
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        CRED APP (on your phone)                             â”‚
â”‚                                                                             â”‚
â”‚   GENERATES (at the start of each login):                                   â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚ code_verifier = random_string(43-128 chars)                         â”‚   â”‚
â”‚   â”‚               = "dBjftJeZ4CVP-mB92K27uhbUJU1p1r_wW1gFWFOEjXk"       â”‚   â”‚
â”‚   â”‚                                                                     â”‚   â”‚
â”‚   â”‚ code_challenge = BASE64URL(SHA256(code_verifier))                   â”‚   â”‚
â”‚   â”‚                = "E9Melhoa2OwvFrEMTJguCHaoeK1t8URWbuGJSstw-cM"      â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚   KEEPS SECRET: code_verifier (never sent until token exchange)             â”‚
â”‚   SENDS TO GOOGLE: code_challenge (the hash - safe to share!)               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              GOOGLE (Auth Server)                           â”‚
â”‚                                                                             â”‚
â”‚   RECEIVES & STORES TEMPORARILY:                                            â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚ code_challenge = "E9Melhoa2OwvFrEMTJguCHaoeK1t8URWbuGJSstw-cM"      â”‚   â”‚
â”‚   â”‚ code_challenge_method = "S256" (SHA-256)                            â”‚   â”‚
â”‚   â”‚ authorization_code = "4/0AX4XfWh..."  â†’ linked to challenge         â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚   VERIFICATION (when CRED exchanges code for token):                        â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚ 1. CRED sends: code + code_verifier                                 â”‚   â”‚
â”‚   â”‚ 2. Google computes: SHA256(code_verifier)                           â”‚   â”‚
â”‚   â”‚ 3. Google checks: computed_hash == stored_code_challenge?           â”‚   â”‚
â”‚   â”‚ 4. If match â†’ Issue tokens! If not â†’ Reject!                        â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</pre>
                    </div>

                    <h4 style="color: #1971c2; margin: 1.5rem 0 0.75rem 0;">Real Code Example:</h4>
                    <div style="background: #1e1e1e; padding: 1rem; border-radius: 8px; overflow-x: auto;">
<pre style="margin: 0; color: #d4d4d4; font-family: 'Fira Code', monospace; font-size: 0.85rem;"><span style="color: #6a9955;"># STEP 1: CRED app generates verifier and challenge</span>
<span style="color: #c586c0;">import</span> <span style="color: #4ec9b0;">secrets</span>, <span style="color: #4ec9b0;">hashlib</span>, <span style="color: #4ec9b0;">base64</span>

<span style="color: #6a9955;"># Generate random string (kept secret on the phone)</span>
<span style="color: #9cdcfe;">code_verifier</span> = secrets.token_urlsafe(<span style="color: #b5cea8;">64</span>)
<span style="color: #6a9955;"># â†’ "dBjftJeZ4CVP-mB92K27uhbUJU1p1r_wW1gFWFOEjXk"</span>

<span style="color: #6a9955;"># Hash it (this gets sent to Google)</span>
<span style="color: #9cdcfe;">challenge_bytes</span> = hashlib.sha256(code_verifier.encode()).digest()
<span style="color: #9cdcfe;">code_challenge</span> = base64.urlsafe_b64encode(challenge_bytes).rstrip(<span style="color: #ce9178;">b'='</span>).decode()
<span style="color: #6a9955;"># â†’ "E9Melhoa2OwvFrEMTJguCHaoeK1t8URWbuGJSstw-cM"</span>

<span style="color: #6a9955;"># STEP 2: Send user to Google with the CHALLENGE (not verifier!)</span>
<span style="color: #9cdcfe;">auth_url</span> = <span style="color: #ce9178;">f"""https://accounts.google.com/o/oauth2/v2/auth?
    client_id=cred-app-12345
    &redirect_uri=cred://callback
    &response_type=code
    &scope=email profile
    &code_challenge=<span style="color: #9cdcfe;">{code_challenge}</span>
    &code_challenge_method=S256"""</span>

<span style="color: #6a9955;"># STEP 3: After user logs in, exchange code WITH the verifier</span>
<span style="color: #9cdcfe;">token_response</span> = requests.post(<span style="color: #ce9178;">"https://oauth2.googleapis.com/token"</span>, data={
    <span style="color: #ce9178;">"client_id"</span>: <span style="color: #ce9178;">"cred-app-12345"</span>,
    <span style="color: #ce9178;">"code"</span>: received_code,
    <span style="color: #ce9178;">"code_verifier"</span>: code_verifier,  <span style="color: #6a9955;"># â† NOW we send the original!</span>
    <span style="color: #ce9178;">"grant_type"</span>: <span style="color: #ce9178;">"authorization_code"</span>,
    <span style="color: #ce9178;">"redirect_uri"</span>: <span style="color: #ce9178;">"cred://callback"</span>
})</pre>
                    </div>

                    <h4 style="color: #1971c2; margin: 1.5rem 0 0.75rem 0;">The Exam Answer Analogy:</h4>
                    <div style="background: #d3f9d8; padding: 1rem; border-radius: 8px; border: 1px solid #69db7c;">
                        <div class="diagram" style="background: #fff; padding: 1rem; border-radius: 8px; font-size: 0.85rem;">
<pre style="margin: 0;">
THE SEALED EXAM ANSWER ANALOGY
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Imagine a competitive exam where you need to prove you knew the answer BEFORE seeing the question:

1. BEFORE THE EXAM (Login starts):
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ You write your answer: "42"                                         â”‚
   â”‚ You put it in a SEALED ENVELOPE (hash it)                           â”‚
   â”‚ You give the sealed envelope to the examiner (Google)               â”‚
   â”‚                                                                     â”‚
   â”‚ You KEEP the original answer ("42") with you                        â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

2. DURING THE EXAM (User authenticates):
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Examiner verifies your identity (Google login)                      â”‚
   â”‚ Gives you a TICKET saying "this person passed" (authorization code) â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

3. CLAIMING YOUR PRIZE (Token exchange):
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ You show: TICKET + original answer "42"                             â”‚
   â”‚ Examiner: Opens sealed envelope, checks if "42" matches             â”‚
   â”‚ If match: "Here's your prize (access_token)!"                       â”‚
   â”‚                                                                     â”‚
   â”‚ If attacker stole your TICKET but doesn't know "42":                â”‚
   â”‚ Examiner: "Wrong answer, no prize for you!"                         â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

KEY INSIGHT:
â€¢ The sealed envelope (hash) travels over the network - safe if intercepted
â€¢ The original answer (verifier) stays on your phone until the very end
â€¢ Even if attacker gets the CODE, they can't guess the 64-char random verifier!
</pre>
                        </div>
                    </div>

                    <!-- Similarity to Public Key Cryptography -->
                    <details style="margin-top: 1.5rem; background: #e7f5ff; border-radius: 8px; padding: 1rem; border: 1px solid #74c0fc;">
                        <summary style="cursor: pointer; font-weight: 600; color: #1971c2;">
                            ğŸ” Is PKCE similar to Public-Private Key Encryption?
                        </summary>
                        <div style="margin-top: 1rem;">
                            <div class="diagram" style="background: #fff; padding: 1rem; border-radius: 8px; font-size: 0.85rem;">
<pre style="margin: 0;">
PKCE vs PUBLIC-PRIVATE KEY: Similar Concept, Different Mechanism
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

SIMILARITIES:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ BOTH follow the pattern:                                                    â”‚
â”‚                                                                             â”‚
â”‚   "I share something PUBLIC (safe to intercept)                             â”‚
â”‚    but keep something PRIVATE that proves I'm the owner"                    â”‚
â”‚                                                                             â”‚
â”‚ PUBLIC-KEY:                                                                 â”‚
â”‚   Public key  â†’ Share with everyone                                         â”‚
â”‚   Private key â†’ Keep secret, proves ownership                               â”‚
â”‚                                                                             â”‚
â”‚ PKCE:                                                                       â”‚
â”‚   code_challenge (hash) â†’ Share with auth server                            â”‚
â”‚   code_verifier         â†’ Keep secret, proves ownership                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

KEY DIFFERENCES:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    PUBLIC-KEY CRYPTO              PKCE                      â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚ Relationship:      Mathematical (RSA/ECDSA)       Hash (SHA-256)            â”‚
â”‚                    Can encrypt AND sign           One-way only              â”‚
â”‚                                                                             â”‚
â”‚ Reusability:       Same keypair for years         One-time per login!       â”‚
â”‚                                                                             â”‚
â”‚ Direction:         Bidirectional                  Unidirectional            â”‚
â”‚                    (encrypt + decrypt)            (only hash â†’ verify)      â”‚
â”‚                                                                             â”‚
â”‚ Complexity:        Complex math operations         Simple hash              â”‚
â”‚                                                                             â”‚
â”‚ Use case:          General encryption/signing     OAuth code protection     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ANALOGY:
â€¢ Public-Key = A mailbox (anyone can drop mail, only you can open)
â€¢ PKCE = A scratch card (you show the scratched answer first,
         then prove you had the card by showing the unscratched original)

BOTTOM LINE:
PKCE is INSPIRED by the same principle as public-key crypto
(share something public, prove with something private)
but uses simpler hash functions instead of complex key math.

It's "public-key thinking" without the heavy cryptographic machinery!
</pre>
                            </div>
                        </div>
                    </details>
                </div>
            </details>
        </div>

        <!-- Client Credentials Flow -->
        <div class="flow-card">
            <div class="flow-title">
                <h2 style="margin: 0;">3. Client Credentials Flow</h2>
                <span class="flow-badge badge-machine">MACHINE-TO-MACHINE</span>
            </div>
            <p><strong>Use for:</strong> Backend services, cron jobs, server-to-server communication (no user involved)</p>
            <p><strong>Real Example:</strong> Swiggy's server fetching restaurant data from a partner API at 3 AM</p>

            <div class="diagram">
<pre style="font-size: 0.9rem; line-height: 1.4;">
CLIENT CREDENTIALS FLOW â€” Example: Swiggy Server + Restaurant Partner API
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

NO USER INVOLVED! This is server talking to server at 3 AM.


    SWIGGY CRON JOB                   PARTNER                    PARTNER
   (Backend Server)                 AUTH SERVER                 DATA API
          â”‚                              â”‚                          â”‚
          â”‚                              â”‚                          â”‚
     â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”                â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
     â”‚ Swiggy  â”‚                    â”‚ Partner â”‚                â”‚Restaurantâ”‚
     â”‚ Server  â”‚                    â”‚  OAuth  â”‚                â”‚  Menu    â”‚
     â”‚(3 AM job)â”‚                   â”‚         â”‚                â”‚   API    â”‚
     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
          â”‚                              â”‚                          â”‚
          â”‚ 1. "I'm Swiggy, here's      â”‚                          â”‚
          â”‚     my credentials"          â”‚                          â”‚
          â”‚     client_id + secret       â”‚                          â”‚
          â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                          â”‚
          â”‚                              â”‚                          â”‚
          â”‚ 2. "OK, here's your token"   â”‚                          â”‚
          â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                          â”‚
          â”‚     access_token             â”‚                          â”‚
          â”‚                              â”‚                          â”‚
          â”‚ 3. Fetch restaurant menus    â”‚                          â”‚
          â”‚     with token               â”‚                          â”‚
          â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
          â”‚     Authorization: Bearer xyz...                        â”‚
          â”‚                              â”‚                          â”‚
          â”‚ 4. Menu data returned        â”‚                          â”‚
          â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
          â”‚                              â”‚                          â”‚


KEY DIFFERENCES FROM OTHER FLOWS:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â€¢ NO user login, NO consent screen â€” it's just machines talking
â€¢ Used for: background jobs, data sync, microservices communication
â€¢ Both client_id AND client_secret are used (server can keep secrets safe)
</pre>
            </div>
        </div>

        <!-- Token Refresh -->
        <div class="section">
            <h2>Token Refresh Flow</h2>
            <p><strong>Real Example:</strong> INDmoney refreshing its Zerodha access token when it expires</p>

            <div class="diagram">
<pre style="font-size: 0.9rem; line-height: 1.4;">
REFRESH TOKEN FLOW â€” Example: INDmoney + Zerodha
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Access tokens are SHORT-LIVED (15 min - 24 hours)
Refresh tokens are LONG-LIVED (7-30 days)


    INDmoney                        ZERODHA                    ZERODHA
     Server                       AUTH SERVER                 HOLDINGS API
       â”‚                               â”‚                           â”‚
       â”‚                               â”‚                           â”‚
       â”‚ 1. Sumit opens app,           â”‚                           â”‚
       â”‚    wants to see holdings      â”‚                           â”‚
       â”‚                               â”‚                           â”‚
       â”‚ 2. Try to fetch with          â”‚                           â”‚
       â”‚    stored access_token        â”‚                           â”‚
       â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
       â”‚                               â”‚                           â”‚
       â”‚ 3. "401 Unauthorized -        â”‚                           â”‚
       â”‚     Token Expired!"           â”‚                           â”‚
       â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
       â”‚                               â”‚                           â”‚
       â”‚ 4. Use refresh_token          â”‚                           â”‚
       â”‚    to get new access_token    â”‚                           â”‚
       â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                           â”‚
       â”‚    grant_type=refresh_token   â”‚                           â”‚
       â”‚                               â”‚                           â”‚
       â”‚ 5. New tokens!                â”‚                           â”‚
       â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                           â”‚
       â”‚    {                          â”‚                           â”‚
       â”‚      access_token: "new...",  â”‚                           â”‚
       â”‚      refresh_token: "rotated" â”‚  â† Some providers rotate  â”‚
       â”‚    }                          â”‚    refresh tokens too!    â”‚
       â”‚                               â”‚                           â”‚
       â”‚ 6. Retry with new token       â”‚                           â”‚
       â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
       â”‚                               â”‚                           â”‚
       â”‚ 7. Holdings data!             â”‚                           â”‚
       â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
       â”‚                               â”‚                           â”‚
       â”‚ 8. Show Sumit his portfolio   â”‚                           â”‚
       â”‚    (he never noticed          â”‚                           â”‚
       â”‚     the refresh happened!)    â”‚                           â”‚
       â”‚                               â”‚                           â”‚


ALL THIS HAPPENS AUTOMATICALLY â€” User never sees it!
</pre>
            </div>

            <div class="warning-box">
                <strong>Token Rotation:</strong> Some providers (like Auth0) give you a NEW refresh token each time you use it.
                If an attacker steals your old refresh token and tries to use it after you've used it, the server knows something is wrong!
            </div>
        </div>

        <div class="section">
            <h2>Security Best Practices</h2>

            <div class="card-grid">
                <div class="card" style="cursor: default; border-color: #51cf66;">
                    <div class="card-icon">ğŸ”</div>
                    <h3>Use HTTPS</h3>
                    <p>Always! Tokens over HTTP can be intercepted.</p>
                </div>
                <div class="card" style="cursor: default; border-color: #51cf66;">
                    <div class="card-icon">ğŸ›¡ï¸</div>
                    <h3>Validate redirect_uri</h3>
                    <p>Whitelist allowed URIs. Prevents open redirect attacks.</p>
                </div>
                <div class="card" style="cursor: default; border-color: #51cf66;">
                    <div class="card-icon">ğŸ”‘</div>
                    <h3>Use state parameter</h3>
                    <p>Random token to prevent CSRF attacks.</p>
                </div>
                <div class="card" style="cursor: default; border-color: #51cf66;">
                    <div class="card-icon">ğŸ“±</div>
                    <h3>Use PKCE</h3>
                    <p>Required for mobile apps and SPAs.</p>
                </div>
            </div>
        </div>

        <!-- Quiz -->
        <div class="quiz-container">
            <div class="quiz-title">ğŸ§  Quick Check</div>
            <p style="margin-bottom: 1rem;">A mobile app needs to implement OAuth login. Which flow should it use?</p>
            <div class="quiz-options">
                <div class="quiz-option" onclick="checkAnswer(this, false)">
                    A) Authorization Code (without PKCE)
                </div>
                <div class="quiz-option" onclick="checkAnswer(this, true)">
                    B) Authorization Code with PKCE
                </div>
                <div class="quiz-option" onclick="checkAnswer(this, false)">
                    C) Client Credentials
                </div>
                <div class="quiz-option" onclick="checkAnswer(this, false)">
                    D) Implicit Flow
                </div>
            </div>
            <div class="quiz-feedback" id="quiz-feedback"></div>
        </div>

        <div class="page-nav">
            <a href="06b_oauth_tokens_explained.html">â† OAuth Tokens Explained</a>
            <a href="08_cheatsheet.html">Next: Cheat Sheet â†’</a>
        </div>

        <footer>
            <p>Page 8 of 9 - Auth Guide 2</p>
        </footer>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
    <script>
        // Interactive Table Functions
        function revealCell(cell) {
            if (!cell.classList.contains('revealed')) {
                cell.classList.add('revealed');
            }
        }

        function revealAllCells(tableId) {
            const table = document.getElementById(tableId);
            const cells = table.querySelectorAll('.hidden-cell');
            let delay = 0;
            cells.forEach(cell => {
                setTimeout(() => {
                    cell.classList.add('revealed');
                }, delay);
                delay += 150;
            });

            // Update button
            const btn = event.target;
            btn.innerHTML = 'âœ… All Revealed';
            btn.classList.add('revealed');
        }

        function checkAnswer(element, isCorrect) {
            const options = document.querySelectorAll('.quiz-option');
            const feedback = document.getElementById('quiz-feedback');
            options.forEach(opt => {
                opt.classList.add('disabled');
                if (opt.onclick.toString().includes('true')) {
                    opt.classList.add('correct');
                }
            });
            if (isCorrect) {
                element.classList.add('correct');
                feedback.className = 'quiz-feedback show correct';
                feedback.innerHTML = 'âœ… Correct! Mobile apps can\'t securely store client_secret, so PKCE (Proof Key for Code Exchange) is required to secure the flow.';
            } else {
                element.classList.add('incorrect');
                feedback.className = 'quiz-feedback show incorrect';
                feedback.innerHTML = 'âŒ Mobile apps are "public clients" - they can\'t safely store secrets. Authorization Code + PKCE is the recommended and secure approach.';
            }
        }
    </script>
</body>
</html>
