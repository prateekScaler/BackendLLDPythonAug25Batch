<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Docker Basics - Interactive Guide</title>
    <style>
        :root {
            --primary: #2d3748;
            --accent: #0db7ed;
            --success: #48bb78;
            --warning: #ed8936;
            --bg: #f7fafc;
            --card: #ffffff;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: var(--bg);
            color: var(--primary);
            line-height: 1.8;
            padding: 24px;
            font-size: 1.1rem;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 0 20px;
        }
        h1 {
            text-align: center;
            margin-bottom: 16px;
            font-size: 2.5em;
        }
        h2 {
            margin: 60px 0 28px;
            font-size: 1.8em;
            color: var(--primary);
            padding-bottom: 12px;
            border-bottom: 3px solid var(--accent);
        }
        h3 {
            margin: 32px 0 16px;
            font-size: 1.3em;
        }
        .subtitle {
            text-align: center;
            color: #718096;
            margin-bottom: 40px;
            font-size: 1.2em;
        }
        p {
            margin-bottom: 16px;
            line-height: 1.9;
        }

        /* Analogy Box */
        .analogy {
            background: linear-gradient(135deg, #faf5ff 0%, #f0e6ff 100%);
            border-left: 5px solid #9f7aea;
            padding: 24px 28px;
            margin: 28px 0;
            border-radius: 0 12px 12px 0;
        }
        .analogy-title {
            font-weight: 700;
            color: #9f7aea;
            margin-bottom: 12px;
            font-size: 1.1em;
        }

        /* Concept Box */
        .concept {
            background: linear-gradient(135deg, #ebf8ff 0%, #e6f6ff 100%);
            border-left: 5px solid var(--accent);
            padding: 24px 28px;
            margin: 28px 0;
            border-radius: 0 12px 12px 0;
        }
        .concept-title {
            font-weight: 700;
            color: var(--accent);
            margin-bottom: 12px;
            font-size: 1.1em;
        }

        /* Key Point */
        .key-point {
            display: inline-block;
            background: #fef3c7;
            padding: 4px 12px;
            border-radius: 6px;
            font-weight: 600;
        }

        /* Progressive Table Styles */
        .progressive-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            margin: 32px 0;
            background: var(--card);
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        }
        .progressive-table thead {
            background: linear-gradient(135deg, #0db7ed 0%, #0a94c2 100%);
            color: white;
        }
        .progressive-table th {
            padding: 20px 24px;
            text-align: left;
            font-weight: 600;
            font-size: 1.05em;
        }
        .progressive-table tbody tr {
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .progressive-table tbody tr:not(:last-child) {
            border-bottom: 1px solid #e2e8f0;
        }
        .progressive-table tbody tr.hidden-row {
            background: #f8fafc;
        }
        .progressive-table tbody tr.hidden-row td {
            padding: 20px 24px;
            color: #a0aec0;
        }
        .progressive-table tbody tr.hidden-row td:not(:first-child) .content {
            visibility: hidden;
            opacity: 0;
            height: 0;
            display: none;
        }
        .progressive-table tbody tr.hidden-row td:not(:first-child)::after {
            content: "Click to reveal";
            font-style: italic;
            font-size: 0.9em;
            color: #a0aec0;
        }
        .progressive-table tbody tr.revealed {
            background: white;
        }
        .progressive-table tbody tr.revealed:hover {
            background: #f0f9ff;
        }
        .progressive-table tbody tr.revealed td:not(:first-child)::after {
            content: "";
        }
        .progressive-table tbody tr td {
            padding: 20px 24px;
            vertical-align: middle;
            transition: all 0.3s ease;
        }
        .progressive-table tbody tr.revealed td .content {
            visibility: visible;
            opacity: 1;
            display: inline;
        }
        .stage-num {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 36px;
            height: 36px;
            background: #e2e8f0;
            color: #718096;
            border-radius: 50%;
            font-weight: 700;
            transition: all 0.3s ease;
        }
        .revealed .stage-num {
            background: var(--accent);
            color: white;
        }
        .command {
            font-family: 'Fira Code', 'Consolas', monospace;
            background: #1a202c;
            color: #68d391;
            padding: 10px 16px;
            border-radius: 8px;
            font-size: 0.9em;
            display: inline-block;
        }
        .command.editor {
            background: #f7fafc;
            color: #718096;
            border: 2px dashed #cbd5e0;
        }
        .click-hint {
            display: flex;
            align-items: center;
            gap: 8px;
            justify-content: center;
            margin-top: 16px;
            color: #718096;
            font-size: 0.95em;
        }
        .click-hint .icon { animation: bounce 2s infinite; }
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }
        .reset-btn {
            display: block;
            margin: 24px auto;
            padding: 12px 28px;
            background: white;
            border: 2px solid var(--accent);
            color: var(--accent);
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        .reset-btn:hover {
            background: var(--accent);
            color: white;
        }
        .progress-indicator {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin: 24px 0;
        }
        .progress-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #e2e8f0;
            transition: all 0.3s ease;
        }
        .progress-dot.active {
            background: var(--accent);
            transform: scale(1.2);
        }
        .all-revealed .click-hint { display: none; }

        /* Flow diagram */
        .flow-diagram {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0;
            margin: 40px 0;
            flex-wrap: wrap;
        }
        .flow-step {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            opacity: 0.3;
            transition: all 0.4s ease;
        }
        .flow-step.active { opacity: 1; }
        .flow-icon {
            width: 70px;
            height: 70px;
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2em;
            margin-bottom: 12px;
        }
        .flow-step:nth-child(1) .flow-icon { background: #e6fffa; }
        .flow-step:nth-child(3) .flow-icon { background: #ebf8ff; }
        .flow-step:nth-child(5) .flow-icon { background: #f0fff4; }
        .flow-step:nth-child(7) .flow-icon { background: #faf5ff; }
        .flow-label { font-weight: 600; color: var(--primary); }
        .flow-arrow {
            font-size: 2em;
            color: #cbd5e0;
            transition: color 0.4s ease;
        }
        .flow-arrow.active { color: var(--accent); }

        /* Dockerfile Progressive Section */
        .dockerfile-section {
            margin: 40px 0;
        }
        .dockerfile-card {
            background: var(--card);
            border-radius: 16px;
            margin-bottom: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            overflow: hidden;
        }
        .dockerfile-header {
            padding: 20px 28px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 16px;
            transition: background 0.2s;
            border-bottom: 1px solid transparent;
        }
        .dockerfile-header:hover { background: #f0f9ff; }
        .dockerfile-card.open .dockerfile-header {
            border-bottom: 1px solid #e2e8f0;
        }
        .dockerfile-level {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
            flex-shrink: 0;
        }
        .level-1 { background: #c6f6d5; color: #276749; }
        .level-2 { background: #bee3f8; color: #2b6cb0; }
        .level-3 { background: #fef3c7; color: #975a16; }
        .level-4 { background: #fed7d7; color: #c53030; }
        .level-5 { background: #e9d8fd; color: #6b46c1; }

        .dockerfile-title {
            flex-grow: 1;
            font-weight: 600;
            font-size: 1.15em;
        }
        .dockerfile-toggle {
            font-size: 1.4em;
            color: #a0aec0;
            transition: transform 0.3s;
        }
        .dockerfile-card.open .dockerfile-toggle {
            transform: rotate(180deg);
        }
        .dockerfile-content {
            display: none;
            padding: 24px 28px;
        }
        .dockerfile-card.open .dockerfile-content {
            display: block;
        }
        .dockerfile-desc {
            margin-bottom: 20px;
            color: #4a5568;
        }
        .whats-new {
            background: #f0fff4;
            border: 2px solid #9ae6b4;
            border-radius: 10px;
            padding: 16px 20px;
            margin-bottom: 24px;
        }
        .whats-new-title {
            font-weight: 700;
            color: var(--success);
            margin-bottom: 8px;
            font-size: 0.95em;
        }
        .whats-new ul {
            margin: 0;
            padding-left: 20px;
        }
        .whats-new li {
            margin: 6px 0;
            color: #276749;
        }

        /* Code block */
        pre.code {
            background: #1a202c;
            color: #e2e8f0;
            padding: 24px 28px;
            border-radius: 12px;
            font-family: 'Fira Code', 'Consolas', monospace;
            font-size: 0.95em;
            overflow-x: auto;
            white-space: pre;
            line-height: 1.7;
            margin: 20px 0;
        }
        pre.code .comment { color: #68d391; }
        pre.code .keyword { color: #63b3ed; }
        pre.code .string { color: #f6ad55; }
        pre.code .new-line {
            background: rgba(72, 187, 120, 0.2);
            display: block;
            margin: 0 -28px;
            padding: 0 28px;
        }

        /* Locked card */
        .dockerfile-card.locked {
            opacity: 0.6;
        }
        .dockerfile-card.locked .dockerfile-header {
            cursor: not-allowed;
        }
        .locked-badge {
            background: #e2e8f0;
            color: #718096;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.8em;
            display: none;
        }
        .dockerfile-card.locked .locked-badge {
            display: inline-block;
        }

        /* Navigation */
        .section-nav {
            position: fixed;
            right: 24px;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            flex-direction: column;
            gap: 12px;
            z-index: 100;
        }
        .nav-dot {
            width: 14px;
            height: 14px;
            border-radius: 50%;
            background: #cbd5e0;
            cursor: pointer;
            transition: all 0.2s;
            border: 2px solid white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .nav-dot:hover, .nav-dot.active {
            background: var(--accent);
            transform: scale(1.2);
        }

        /* Responsive */
        @media (max-width: 768px) {
            body { font-size: 1rem; padding: 16px; }
            .progressive-table th, .progressive-table td {
                padding: 14px 16px;
                font-size: 0.95em;
            }
            .command { font-size: 0.8em; padding: 8px 12px; }
            .section-nav { display: none; }
            pre.code { padding: 18px 16px; font-size: 0.85em; }
        }
        @media (min-width: 1200px) {
            body { font-size: 1.2rem; }
            .container { max-width: 1100px; }
        }

        /* Comparison boxes */
        .comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 28px 0;
        }
        .comparison-box {
            padding: 24px;
            border-radius: 12px;
        }
        .comparison-box.without {
            background: #fff5f5;
            border: 2px solid #feb2b2;
        }
        .comparison-box.with {
            background: #f0fff4;
            border: 2px solid #9ae6b4;
        }
        .comparison-title {
            font-weight: 700;
            margin-bottom: 12px;
            font-size: 1.05em;
        }
        .comparison-box.without .comparison-title { color: #c53030; }
        .comparison-box.with .comparison-title { color: #276749; }
        @media (max-width: 768px) {
            .comparison { grid-template-columns: 1fr; }
        }

        /* Controls bar */
        .controls-bar {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin: 32px 0;
            flex-wrap: wrap;
        }
        .control-btn {
            padding: 10px 20px;
            border: 2px solid #e2e8f0;
            background: white;
            border-radius: 8px;
            font-size: 0.95em;
            cursor: pointer;
            transition: all 0.2s;
        }
        .control-btn:hover {
            border-color: var(--accent);
            color: var(--accent);
        }
        .control-btn.active {
            background: var(--accent);
            color: white;
            border-color: var(--accent);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Docker Fundamentals</h1>
        <p class="subtitle">Understanding Containers from First Principles</p>

        <!-- Section 1: The Why -->
        <h2 id="why">Why Docker Exists</h2>

        <div class="analogy">
            <div class="analogy-title">Think About This...</div>
            <p>You write code on your Mac with Python 3.11. Your teammate uses Windows with Python 3.9. The server runs Ubuntu with Python 3.8. Your code works locally but crashes in production.</p>
            <p style="margin-top: 12px; font-weight: 600;">"But it works on my machine!" - Every developer, ever</p>
        </div>

        <div class="concept">
            <div class="concept-title">The Core Problem</div>
            <p>Software doesn't run in isolation. It depends on:</p>
            <ul style="margin: 12px 0 0 24px;">
                <li>Operating system (Ubuntu vs Alpine vs Windows)</li>
                <li>Language runtime (Python 3.8 vs 3.11)</li>
                <li>System libraries (libssl, libxml, etc.)</li>
                <li>Environment variables and config files</li>
            </ul>
            <p style="margin-top: 16px;"><span class="key-point">Docker packages your code WITH its entire environment.</span></p>
        </div>

        <div class="comparison">
            <div class="comparison-box without">
                <div class="comparison-title">Without Docker</div>
                <ul style="margin-left: 20px;">
                    <li>"Install Python 3.11 first"</li>
                    <li>"You need libpq-dev for PostgreSQL"</li>
                    <li>"Set these 15 environment variables"</li>
                    <li>"It worked yesterday, what changed?"</li>
                </ul>
            </div>
            <div class="comparison-box with">
                <div class="comparison-title">With Docker</div>
                <ul style="margin-left: 20px;">
                    <li><code>docker run myapp</code></li>
                    <li>Same on Mac, Windows, Linux, Cloud</li>
                    <li>Dependencies baked into image</li>
                    <li>Runs identically every time</li>
                </ul>
            </div>
        </div>

        <!-- Section 2: Core Concepts -->
        <h2 id="concepts">Three Things to Understand</h2>

        <h3>1. Dockerfile = Recipe</h3>
        <p>A text file with instructions to build your environment. Like a recipe that says "start with Ubuntu, add Python, copy my code, install dependencies."</p>

        <h3>2. Image = Snapshot</h3>
        <p>The result of running a Dockerfile. A <strong>read-only</strong> template containing your OS + code + dependencies. Like a class definition in OOP.</p>

        <h3>3. Container = Running Instance</h3>
        <p>A running instance of an image. Like an object created from a class. You can have many containers from one image.</p>

        <div class="analogy">
            <div class="analogy-title">OOP Analogy</div>
            <p><strong>Dockerfile</strong> = Source code of a class</p>
            <p><strong>Image</strong> = Compiled class</p>
            <p><strong>Container</strong> = Object instance (new MyClass())</p>
        </div>

        <!-- Section 3: The Workflow -->
        <h2 id="workflow">The Docker Workflow</h2>
        <p>Click each row in sequence to reveal the 4-step workflow:</p>

        <!-- Visual Flow Diagram -->
        <div class="flow-diagram" id="flowDiagram">
            <div class="flow-step" data-step="1">
                <div class="flow-icon">üìù</div>
                <div class="flow-label">Dockerfile</div>
            </div>
            <div class="flow-arrow">‚Üí</div>
            <div class="flow-step" data-step="2">
                <div class="flow-icon">üì¶</div>
                <div class="flow-label">Image</div>
            </div>
            <div class="flow-arrow">‚Üí</div>
            <div class="flow-step" data-step="3">
                <div class="flow-icon">üöÄ</div>
                <div class="flow-label">Container</div>
            </div>
            <div class="flow-arrow">‚Üí</div>
            <div class="flow-step" data-step="4">
                <div class="flow-icon">‚òÅÔ∏è</div>
                <div class="flow-label">Registry</div>
            </div>
        </div>

        <div class="progress-indicator" id="progressIndicator">
            <div class="progress-dot" data-step="1"></div>
            <div class="progress-dot" data-step="2"></div>
            <div class="progress-dot" data-step="3"></div>
            <div class="progress-dot" data-step="4"></div>
        </div>

        <div id="tableContainer">
            <table class="progressive-table" id="workflowTable">
                <thead>
                    <tr>
                        <th style="width: 70px;">Step</th>
                        <th style="width: 45%;">What Happens</th>
                        <th>Command</th>
                    </tr>
                </thead>
                <tbody>
                    <tr class="hidden-row" data-row="1">
                        <td><span class="stage-num">1</span></td>
                        <td><span class="content"><strong>Write Dockerfile</strong><br>Create a text file describing your environment and how to set it up</span></td>
                        <td><span class="content"><code class="command editor">vim Dockerfile</code></span></td>
                    </tr>
                    <tr class="hidden-row" data-row="2">
                        <td><span class="stage-num">2</span></td>
                        <td><span class="content"><strong>Build Image</strong><br>Docker reads the Dockerfile and creates a read-only snapshot</span></td>
                        <td><span class="content"><code class="command">docker build -t myapp:1.0 .</code></span></td>
                    </tr>
                    <tr class="hidden-row" data-row="3">
                        <td><span class="stage-num">3</span></td>
                        <td><span class="content"><strong>Run Container</strong><br>Create a running instance from the image</span></td>
                        <td><span class="content"><code class="command">docker run -p 5000:5000 myapp:1.0</code></span></td>
                    </tr>
                    <tr class="hidden-row" data-row="4">
                        <td><span class="stage-num">4</span></td>
                        <td><span class="content"><strong>Push to Registry</strong><br>Share your image on Docker Hub or private registry</span></td>
                        <td><span class="content"><code class="command">docker push mycompany/myapp:1.0</code></span></td>
                    </tr>
                </tbody>
            </table>
            <p class="click-hint" id="clickHint">
                <span class="icon">üëÜ</span>
                <span>Click each row to reveal ‚Ä¢ Press <kbd>Space</kbd> or <kbd>‚Üí</kbd> for next</span>
            </p>
        </div>
        <button class="reset-btn" id="resetBtn" style="display: none;">Reset Table</button>

        <!-- Section 4: Dockerfile Evolution -->
        <h2 id="dockerfiles">Dockerfile: From Simple to Production</h2>
        <p>Let's build a Dockerfile for a Flask API, progressively adding production best practices. <strong>Click each level to unlock the next.</strong></p>

        <div class="controls-bar">
            <button class="control-btn" onclick="resetDockerfiles()">Reset All</button>
            <button class="control-btn" onclick="revealAllDockerfiles()">Reveal All</button>
        </div>

        <div class="dockerfile-section" id="dockerfileSection">

            <!-- Level 1: Bare Minimum -->
            <div class="dockerfile-card open" data-level="1">
                <div class="dockerfile-header" onclick="toggleDockerfile(this)">
                    <span class="dockerfile-level level-1">Level 1</span>
                    <span class="dockerfile-title">Bare Minimum - "It runs"</span>
                    <span class="locked-badge">Complete previous first</span>
                    <span class="dockerfile-toggle">‚ñº</span>
                </div>
                <div class="dockerfile-content">
                    <p class="dockerfile-desc">The simplest possible Dockerfile. Just enough to run a Flask app.</p>

<pre class="code"><span class="comment"># Start with Python base image</span>
<span class="keyword">FROM</span> python:3.11

<span class="comment"># Copy everything into container</span>
<span class="keyword">COPY</span> . /app

<span class="comment"># Install Flask</span>
<span class="keyword">RUN</span> pip install flask

<span class="comment"># Run the app</span>
<span class="keyword">CMD</span> ["python", "/app/app.py"]</pre>

                    <div class="concept">
                        <div class="concept-title">What Each Line Does</div>
                        <p><code>FROM</code> - Start with an existing image (Python installed on Debian)</p>
                        <p><code>COPY</code> - Copy files from your machine into the image</p>
                        <p><code>RUN</code> - Execute a command during build</p>
                        <p><code>CMD</code> - Default command when container starts</p>
                    </div>

                    <p><strong>Problems with this approach:</strong></p>
                    <ul style="margin-left: 24px; color: #c53030;">
                        <li>No working directory set (messy)</li>
                        <li>Copies everything, including junk files</li>
                        <li>No port exposed</li>
                        <li>Reinstalls dependencies on every code change</li>
                    </ul>

                    <button class="control-btn" onclick="unlockNext(1)" style="margin-top: 20px;">Unlock Next Level ‚Üí</button>
                </div>
            </div>

            <!-- Level 2: Organized -->
            <div class="dockerfile-card locked" data-level="2">
                <div class="dockerfile-header" onclick="toggleDockerfile(this)">
                    <span class="dockerfile-level level-2">Level 2</span>
                    <span class="dockerfile-title">Organized - Working Directory & Port</span>
                    <span class="locked-badge">Complete previous first</span>
                    <span class="dockerfile-toggle">‚ñº</span>
                </div>
                <div class="dockerfile-content">
                    <p class="dockerfile-desc">Add structure with WORKDIR and expose the port.</p>

                    <div class="whats-new">
                        <div class="whats-new-title">What's New</div>
                        <ul>
                            <li><code>WORKDIR</code> - Sets the working directory inside container</li>
                            <li><code>EXPOSE</code> - Documents which port the app uses</li>
                        </ul>
                    </div>

<pre class="code"><span class="keyword">FROM</span> python:3.11

<span class="new-line"><span class="comment"># Set working directory</span>
<span class="keyword">WORKDIR</span> /app</span>

<span class="comment"># Copy everything</span>
<span class="keyword">COPY</span> . .

<span class="comment"># Install Flask</span>
<span class="keyword">RUN</span> pip install flask

<span class="new-line"><span class="comment"># Document the port (doesn't actually publish it)</span>
<span class="keyword">EXPOSE</span> 5000</span>

<span class="keyword">CMD</span> ["python", "app.py"]</pre>

                    <div class="concept">
                        <div class="concept-title">WORKDIR vs cd</div>
                        <p><code>WORKDIR /app</code> creates the directory if it doesn't exist and sets it as the current directory for all following commands. It's cleaner than <code>RUN cd /app</code>.</p>
                    </div>

                    <button class="control-btn" onclick="unlockNext(2)" style="margin-top: 20px;">Unlock Next Level ‚Üí</button>
                </div>
            </div>

            <!-- Level 3: Dependencies First -->
            <div class="dockerfile-card locked" data-level="3">
                <div class="dockerfile-header" onclick="toggleDockerfile(this)">
                    <span class="dockerfile-level level-3">Level 3</span>
                    <span class="dockerfile-title">Smart Caching - Dependencies First</span>
                    <span class="locked-badge">Complete previous first</span>
                    <span class="dockerfile-toggle">‚ñº</span>
                </div>
                <div class="dockerfile-content">
                    <p class="dockerfile-desc">Leverage Docker's layer caching by copying requirements.txt first.</p>

                    <div class="whats-new">
                        <div class="whats-new-title">What's New</div>
                        <ul>
                            <li>Copy <code>requirements.txt</code> before copying code</li>
                            <li>Docker caches each layer - dependencies won't reinstall on code changes</li>
                        </ul>
                    </div>

<pre class="code"><span class="keyword">FROM</span> python:3.11

<span class="keyword">WORKDIR</span> /app

<span class="new-line"><span class="comment"># Copy dependencies file FIRST (this layer is cached)</span>
<span class="keyword">COPY</span> requirements.txt .</span>

<span class="new-line"><span class="comment"># Install dependencies (cached if requirements.txt unchanged)</span>
<span class="keyword">RUN</span> pip install --no-cache-dir -r requirements.txt</span>

<span class="comment"># NOW copy the rest of the code (changes frequently)</span>
<span class="keyword">COPY</span> . .

<span class="keyword">EXPOSE</span> 5000

<span class="keyword">CMD</span> ["python", "app.py"]</pre>

                    <div class="analogy">
                        <div class="analogy-title">Why This Matters</div>
                        <p>Docker builds images in layers. Each instruction = one layer. If a layer hasn't changed, Docker uses the cached version.</p>
                        <p style="margin-top: 8px;"><strong>Before:</strong> Change 1 line of code ‚Üí reinstall all dependencies (slow)</p>
                        <p><strong>After:</strong> Change 1 line of code ‚Üí reuse cached dependencies (fast)</p>
                    </div>

                    <button class="control-btn" onclick="unlockNext(3)" style="margin-top: 20px;">Unlock Next Level ‚Üí</button>
                </div>
            </div>

            <!-- Level 4: Slim Image -->
            <div class="dockerfile-card locked" data-level="4">
                <div class="dockerfile-header" onclick="toggleDockerfile(this)">
                    <span class="dockerfile-level level-4">Level 4</span>
                    <span class="dockerfile-title">Slim Image - Reduce Size</span>
                    <span class="locked-badge">Complete previous first</span>
                    <span class="dockerfile-toggle">‚ñº</span>
                </div>
                <div class="dockerfile-content">
                    <p class="dockerfile-desc">Use a smaller base image and avoid unnecessary files.</p>

                    <div class="whats-new">
                        <div class="whats-new-title">What's New</div>
                        <ul>
                            <li><code>python:3.11-slim</code> - Smaller base image (~150MB vs ~900MB)</li>
                            <li><code>.dockerignore</code> - Exclude files from the build context</li>
                        </ul>
                    </div>

<pre class="code"><span class="new-line"><span class="comment"># Use slim variant (much smaller!)</span>
<span class="keyword">FROM</span> python:3.11-slim</span>

<span class="keyword">WORKDIR</span> /app

<span class="keyword">COPY</span> requirements.txt .

<span class="keyword">RUN</span> pip install --no-cache-dir -r requirements.txt

<span class="keyword">COPY</span> . .

<span class="keyword">EXPOSE</span> 5000

<span class="keyword">CMD</span> ["python", "app.py"]</pre>

                    <p style="margin-top: 16px;"><strong>Also create <code>.dockerignore</code>:</strong></p>

<pre class="code"><span class="comment"># .dockerignore - files to exclude from build</span>
__pycache__
*.pyc
.git
.env
.venv
*.md
tests/
.coverage</pre>

                    <div class="comparison">
                        <div class="comparison-box without">
                            <div class="comparison-title">python:3.11</div>
                            <p>~900MB, includes compilers, dev tools</p>
                        </div>
                        <div class="comparison-box with">
                            <div class="comparison-title">python:3.11-slim</div>
                            <p>~150MB, minimal runtime only</p>
                        </div>
                    </div>

                    <button class="control-btn" onclick="unlockNext(4)" style="margin-top: 20px;">Unlock Final Level ‚Üí</button>
                </div>
            </div>

            <!-- Level 5: Production Ready -->
            <div class="dockerfile-card locked" data-level="5">
                <div class="dockerfile-header" onclick="toggleDockerfile(this)">
                    <span class="dockerfile-level level-5">Level 5</span>
                    <span class="dockerfile-title">Production Ready - Security & Best Practices</span>
                    <span class="locked-badge">Complete previous first</span>
                    <span class="dockerfile-toggle">‚ñº</span>
                </div>
                <div class="dockerfile-content">
                    <p class="dockerfile-desc">The complete production Dockerfile with security hardening.</p>

                    <div class="whats-new">
                        <div class="whats-new-title">What's New</div>
                        <ul>
                            <li>Non-root user (security best practice)</li>
                            <li>Health check for orchestrators</li>
                            <li>Production WSGI server (Gunicorn)</li>
                            <li>Environment variables</li>
                        </ul>
                    </div>

<pre class="code"><span class="keyword">FROM</span> python:3.11-slim

<span class="new-line"><span class="comment"># Set environment variables</span>
<span class="keyword">ENV</span> PYTHONDONTWRITEBYTECODE=1 \
    PYTHONUNBUFFERED=1 \
    PIP_NO_CACHE_DIR=1</span>

<span class="keyword">WORKDIR</span> /app

<span class="new-line"><span class="comment"># Create non-root user for security</span>
<span class="keyword">RUN</span> groupadd --gid 1000 appgroup && \
    useradd --uid 1000 --gid appgroup --shell /bin/bash appuser</span>

<span class="comment"># Install dependencies as root</span>
<span class="keyword">COPY</span> requirements.txt .
<span class="keyword">RUN</span> pip install --no-cache-dir -r requirements.txt

<span class="comment"># Copy application code</span>
<span class="keyword">COPY</span> --chown=appuser:appgroup . .

<span class="new-line"><span class="comment"># Switch to non-root user</span>
<span class="keyword">USER</span> appuser</span>

<span class="keyword">EXPOSE</span> 5000

<span class="new-line"><span class="comment"># Health check for container orchestrators</span>
<span class="keyword">HEALTHCHECK</span> --interval=30s --timeout=10s --start-period=5s --retries=3 \
    CMD curl -f http://localhost:5000/health || exit 1</span>

<span class="new-line"><span class="comment"># Use production WSGI server</span>
<span class="keyword">CMD</span> ["gunicorn", "--bind", "0.0.0.0:5000", "--workers", "4", "app:app"]</span></pre>

                    <div class="concept">
                        <div class="concept-title">Why Non-Root User?</div>
                        <p>If an attacker exploits a vulnerability in your app, they get the permissions of the running user. Running as root = attacker has root access to the container (and potentially the host). Running as <code>appuser</code> limits the blast radius.</p>
                    </div>

                    <div class="concept">
                        <div class="concept-title">Why Gunicorn?</div>
                        <p>Flask's built-in server is for development only. It can't handle concurrent requests efficiently. Gunicorn is a production WSGI server that:</p>
                        <ul style="margin: 8px 0 0 24px;">
                            <li>Spawns multiple worker processes</li>
                            <li>Handles concurrent requests</li>
                            <li>Restarts crashed workers</li>
                            <li>Manages graceful shutdowns</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- Summary -->
        <h2 id="summary">Quick Reference</h2>

        <div class="concept">
            <div class="concept-title">Essential Commands</div>
<pre class="code" style="background: #2d3748;"><span class="comment"># Build an image</span>
docker build -t myapp:1.0 .

<span class="comment"># Run a container</span>
docker run -p 5000:5000 myapp:1.0

<span class="comment"># Run in background (detached)</span>
docker run -d -p 5000:5000 myapp:1.0

<span class="comment"># List running containers</span>
docker ps

<span class="comment"># Stop a container</span>
docker stop &lt;container_id&gt;

<span class="comment"># View logs</span>
docker logs &lt;container_id&gt;

<span class="comment"># Shell into running container</span>
docker exec -it &lt;container_id&gt; /bin/bash</pre>
        </div>

    </div>

    <script>
        // Workflow Table Logic
        let currentStep = 0;
        const totalSteps = 4;

        function revealRow(rowNum) {
            if (rowNum !== currentStep + 1) return;

            const row = document.querySelector(`tr[data-row="${rowNum}"]`);
            if (row && row.classList.contains('hidden-row')) {
                row.classList.remove('hidden-row');
                row.classList.add('revealed');
                currentStep = rowNum;

                document.querySelector(`.progress-dot[data-step="${rowNum}"]`).classList.add('active');

                const flowStep = document.querySelector(`.flow-step[data-step="${rowNum}"]`);
                if (flowStep) flowStep.classList.add('active');

                const arrows = document.querySelectorAll('.flow-arrow');
                if (rowNum > 1) arrows[rowNum - 2].classList.add('active');

                if (currentStep >= totalSteps) {
                    document.getElementById('tableContainer').classList.add('all-revealed');
                    document.getElementById('resetBtn').style.display = 'block';
                }
            }
        }

        function resetTable() {
            currentStep = 0;
            document.querySelectorAll('#workflowTable tbody tr').forEach(row => {
                row.classList.add('hidden-row');
                row.classList.remove('revealed');
            });
            document.querySelectorAll('.progress-dot').forEach(dot => dot.classList.remove('active'));
            document.querySelectorAll('.flow-step').forEach(step => step.classList.remove('active'));
            document.querySelectorAll('.flow-arrow').forEach(arrow => arrow.classList.remove('active'));
            document.getElementById('tableContainer').classList.remove('all-revealed');
            document.getElementById('resetBtn').style.display = 'none';
        }

        document.querySelectorAll('#workflowTable tbody tr').forEach(row => {
            row.addEventListener('click', () => revealRow(parseInt(row.dataset.row)));
        });

        document.getElementById('resetBtn').addEventListener('click', resetTable);

        // Dockerfile Section Logic
        let unlockedLevel = 1;

        function toggleDockerfile(header) {
            const card = header.parentElement;
            const level = parseInt(card.dataset.level);

            if (card.classList.contains('locked')) return;

            card.classList.toggle('open');
        }

        function unlockNext(currentLevel) {
            if (currentLevel >= unlockedLevel) {
                unlockedLevel = currentLevel + 1;
                const nextCard = document.querySelector(`.dockerfile-card[data-level="${unlockedLevel}"]`);
                if (nextCard) {
                    nextCard.classList.remove('locked');
                    nextCard.classList.add('open');
                    // Close current
                    document.querySelector(`.dockerfile-card[data-level="${currentLevel}"]`).classList.remove('open');
                    // Scroll to next
                    nextCard.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
            }
        }

        function resetDockerfiles() {
            unlockedLevel = 1;
            document.querySelectorAll('.dockerfile-card').forEach((card, index) => {
                if (index === 0) {
                    card.classList.remove('locked');
                    card.classList.add('open');
                } else {
                    card.classList.add('locked');
                    card.classList.remove('open');
                }
            });
        }

        function revealAllDockerfiles() {
            unlockedLevel = 5;
            document.querySelectorAll('.dockerfile-card').forEach(card => {
                card.classList.remove('locked');
            });
        }

        // Keyboard navigation
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' || e.key === ' ' || e.key === 'ArrowRight' || e.key === 'ArrowDown') {
                e.preventDefault();
                revealRow(currentStep + 1);
            }
            if (e.key === 'r' || e.key === 'R') {
                resetTable();
            }
        });
    </script>
</body>
</html>
